<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Better Programmer - Premium Programming E-Books Library</title>
    <!-- Google Fonts & Icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,0,0">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/codemirror.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/theme/vs-dark.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/addon/hint/show-hint.min.css" rel="stylesheet">
    <style>
        /* ===== CSS Variables & Reset ===== */
        :root {
            --primary-bg: #0a0a0f;
            --secondary-bg: #0f1117;
            --accent-blue: #007acc;
            --accent-purple: #c586c0;
            --accent-green: #10b981;
            --accent-orange: #f59e0b;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-color: #1e293b;
            --border-light: #334155;
            --glass-bg: rgba(30, 41, 59, 0.6);
            --glass-border: rgba(255, 255, 255, 0.1);
            --card-bg: rgba(15, 23, 42, 0.8);
            --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.4);
            --shadow-xl: 0 25px 50px rgba(0, 0, 0, 0.5);
            --gradient-primary: linear-gradient(135deg, #007acc, #c586c0);
            --gradient-secondary: linear-gradient(135deg, #10b981, #007acc);
            --gradient-dark: linear-gradient(135deg, #0f172a, #1e293b);
            --vscode-bg: #1e1e1e;
            --vscode-sidebar: #252526;
            --vscode-tab: #2d2d30;
            --vscode-text: #d4d4d4;
            --vscode-blue: #007acc;
            --vscode-purple: #c586c0;
            --vscode-green: #4ec9b0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--primary-bg);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* ===== Utility Classes ===== */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .section {
            padding: 100px 0;
        }

        .section-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .section-subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            max-width: 600px;
            margin-bottom: 3rem;
        }

        /* ===== Background Effects ===== */
        .bg-effects {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .gradient-circle {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.15;
        }

        .circle-1 {
            width: 600px;
            height: 600px;
            background: var(--accent-blue);
            top: -300px;
            right: -200px;
        }

        .circle-2 {
            width: 500px;
            height: 500px;
            background: var(--accent-purple);
            bottom: -200px;
            left: -200px;
        }

        .grid-pattern {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: linear-gradient(to right, rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            opacity: 0.5;
        }

        /* ===== Cookies Consent ===== */
        .cookie-consent {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: var(--card-bg);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            padding: 1.5rem;
            z-index: 9999;
            box-shadow: var(--shadow-xl);
            max-width: 500px;
            animation: slideUp 0.3s ease;
            display: none;
        }

        .cookie-content {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .cookie-content .material-symbols-rounded {
            font-size: 2rem;
            color: var(--accent-blue);
        }

        .cookie-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .cookie-link {
            color: var(--accent-blue);
            text-decoration: none;
            font-size: 0.9rem;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* ===== IMPROVED Header & Navigation ===== */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            background: rgba(10, 10, 15, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
        }

        .navbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient-primary);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }

        .logo-text {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--text-primary), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-links {
            display: flex;
            gap: 1.5rem;
            list-style: none;
        }

        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            padding: 10px 16px;
            border-radius: 8px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
            position: relative;
            overflow: hidden;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 2px;
            background: var(--gradient-primary);
            transition: width 0.3s ease;
        }

        .nav-link:hover::after,
        .nav-link.active::after {
            width: 80%;
        }

        .nav-link:hover,
        .nav-link.active {
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.03);
        }

        .nav-link .material-symbols-rounded {
            font-size: 1.2rem;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .search-box {
            position: relative;
            width: 280px;
        }

        .search-box:focus-within {
            transform: scale(1.02);
        }

        .search-input {
            width: 100%;
            padding: 10px 40px 10px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(0, 122, 204, 0.1);
        }

        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .cart-btn {
            position: relative;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            width: 42px;
            height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cart-btn:hover {
            color: var(--accent-blue);
            border-color: var(--accent-blue);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--accent-orange);
            color: white;
            font-size: 0.7rem;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .chat-btn {
            position: relative;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            width: 42px;
            height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 0.5rem;
        }

        .chat-btn:hover {
            color: var(--accent-purple);
            border-color: var(--accent-purple);
            transform: translateY(-2px);
        }

        .chat-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ef4444;
            color: white;
            font-size: 0.7rem;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            display: none;
        }

        .auth-btn {
            padding: 10px 24px;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 122, 204, 0.3);
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 8px;
        }

        /* ===== Hero Section ===== */
        .hero {
            min-height: 100vh;
            display: flex;
            align-items: center;
            padding-top: 100px;
            position: relative;
            overflow: hidden;
        }

        .hero-content {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .hero-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 5rem;
            font-weight: 800;
            line-height: 1.1;
            margin-bottom: 1.5rem;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple), #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradient-shift 8s ease infinite;
            background-size: 200% 200%;
        }

        @keyframes gradient-shift {
            0%, 100% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
        }

        .hero-subtitle {
            font-size: 1.25rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-stats {
            display: flex;
            justify-content: center;
            gap: 3rem;
            margin: 3rem 0;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--accent-blue);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .cta-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }

        .btn {
            padding: 12px 32px;
            border-radius: 8px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            font-size: 1rem;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 122, 204, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* ===== Books Section ===== */
        .books-section {
            background: var(--gradient-dark);
            position: relative;
        }

        .books-header {
            text-align: center;
            margin-bottom: 4rem;
        }

        .filters-container {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 3rem;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-select {
            padding: 10px 12px;
            background: #000000;
            border: 1px solid var(--border-light);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(0, 122, 204, 0.1);
        }

        .filter-select option {
            background: #000000;
            color: var(--text-primary);
            padding: 10px;
        }

        .filter-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .books-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        /* ===== Book Card Design ===== */
        .book-card {
            background: var(--card-bg);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
        }

        .book-card:hover {
            transform: translateY(-8px);
            border-color: var(--accent-blue);
            box-shadow: var(--shadow-xl);
        }

        .book-cover {
            position: relative;
            height: 240px;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.5), rgba(15, 23, 42, 0.8));
            overflow: hidden;
        }

        .book-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .book-card:hover .book-image {
            transform: scale(1.05);
        }

        .book-badges {
            position: absolute;
            top: 16px;
            right: 16px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .badge-free {
            background: linear-gradient(135deg, var(--accent-green), #34d399);
            color: black;
        }

        .badge-new {
            background: linear-gradient(135deg, var(--accent-blue), #60a5fa);
            color: white;
        }

        .badge-popular {
            background: linear-gradient(135deg, var(--accent-purple), #a78bfa);
            color: white;
        }

        .book-info {
            padding: 1.5rem;
        }

        .book-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .book-author {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .book-description {
            color: var(--text-muted);
            font-size: 0.9rem;
            line-height: 1.6;
            margin-bottom: 1.5rem;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .book-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-top: 1px solid var(--border-light);
            margin-bottom: 1rem;
        }

        .book-category {
            padding: 4px 12px;
            background: rgba(0, 122, 204, 0.1);
            border: 1px solid rgba(0, 122, 204, 0.2);
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--accent-blue);
        }

        .book-rating {
            display: flex;
            align-items: center;
            gap: 4px;
            color: var(--accent-orange);
        }

        .book-price-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .book-price {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--accent-blue);
        }

        .book-price-free {
            color: var(--accent-green);
        }

        .book-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        .btn-small {
            padding: 10px 16px;
            font-size: 0.9rem;
        }

        .btn-fullwidth {
            grid-column: 1 / -1;
        }

        .btn-cart {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-light);
            color: var(--text-primary);
        }

        .btn-cart:hover {
            background: rgba(0, 122, 204, 0.1);
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }

        /* ===== Main Content Container ===== */
        #mainContent {
            min-height: 60vh;
            padding-top: 140px;
        }

        /* ===== Pages Styling ===== */
        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        /* Categories Page */
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
        }

        .category-card {
            background: var(--card-bg);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .category-card:hover {
            border-color: var(--accent-blue);
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .category-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--accent-blue);
        }

        /* FAQ Page */
        .faq-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .faq-item {
            background: var(--card-bg);
            border: 1px solid var(--border-light);
            border-radius: 12px;
            margin-bottom: 1rem;
            overflow: hidden;
        }

        .faq-question {
            padding: 1.5rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .faq-answer {
            padding: 0 1.5rem 1.5rem;
            color: var(--text-secondary);
            display: none;
        }

        .faq-item.active .faq-answer {
            display: block;
        }

        /* Profile Page */
        .profile-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .profile-avatar {
            width: 150px;
            height: 150px;
            background: var(--gradient-primary);
            border-radius: 50%;
            margin: 0 auto 1.5rem;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .profile-avatar:hover {
            transform: scale(1.05);
            box-shadow: 0 0 0 5px rgba(0, 122, 204, 0.2);
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-avatar .avatar-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: white;
        }

        .avatar-upload-btn {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: var(--accent-blue);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .profile-avatar:hover .avatar-upload-btn {
            opacity: 1;
        }

        .profile-info {
            background: var(--card-bg);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            padding: 2rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-light);
        }

        .info-row:last-child {
            border-bottom: none;
        }

        /* ===== Enhanced Admin Panel ===== */
        .admin-panel {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 2rem;
            min-height: 70vh;
        }

        .admin-sidebar {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 122, 204, 0.2);
            border-radius: 16px;
            padding: 1.5rem;
        }

        .admin-sidebar h3 {
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-light);
        }

        .admin-menu {
            list-style: none;
        }

        .admin-menu li {
            margin-bottom: 0.5rem;
        }

        .admin-menu a {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 12px;
            transition: all 0.3s ease;
            margin: 4px 0;
        }

        .admin-menu a:hover,
        .admin-menu a.active {
            background: linear-gradient(135deg, rgba(0, 122, 204, 0.2), rgba(197, 134, 192, 0.1));
            border-left: 4px solid var(--accent-blue);
            color: var(--accent-blue);
        }

        .admin-content {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 122, 204, 0.2);
            border-radius: 16px;
            padding: 2rem;
            overflow-y: auto;
        }

        .admin-section {
            display: none;
        }

        .admin-section.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), transparent);
            border: 1px solid rgba(0, 122, 204, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-blue);
        }

        .stat-card-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-blue);
            margin-bottom: 0.5rem;
        }

        .stat-card-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* ===== Chat System ===== */
        .chat-container {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 350px;
            height: 500px;
            background: var(--card-bg);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            box-shadow: var(--shadow-xl);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            display: none;
        }

        .chat-header {
            padding: 1rem;
            background: rgba(0, 122, 204, 0.1);
            border-bottom: 1px solid var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .message {
            max-width: 80%;
            padding: 0.75rem;
            border-radius: 12px;
            word-wrap: break-word;
        }

        .message.user {
            align-self: flex-end;
            background: var(--gradient-primary);
            color: white;
        }

        .message.admin {
            align-self: flex-start;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-light);
        }

        .chat-input {
            padding: 1rem;
            border-top: 1px solid var(--border-light);
            display: flex;
            gap: 0.5rem;
        }

        .chat-input textarea {
            flex: 1;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            color: var(--text-primary);
            resize: none;
            font-family: 'Inter', sans-serif;
        }

        .chat-input button {
            padding: 10px 20px;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        /* ===== Code Editor Page ===== */
        .code-editor-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            height: 70vh;
        }

        .code-editor-section,
        .preview-section {
            display: flex;
            flex-direction: column;
        }

        .code-editor-section h3,
        .preview-section h3 {
            margin-bottom: 1rem;
            color: var(--text-primary);
            font-family: 'Space Grotesk', sans-serif;
        }

        .editor-toolbar {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            background: var(--vscode-sidebar);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid var(--border-light);
        }

        .editor-container {
            flex: 1;
            border-radius: 8px;
            overflow: hidden;
            background: var(--vscode-bg);
            border: 1px solid var(--border-light);
        }

        .CodeMirror {
            height: 100% !important;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
        }

        .preview-container {
            flex: 1;
            border: 1px solid var(--border-light);
            border-radius: 8px;
            background: white;
            overflow: hidden;
            position: relative;
        }

        .preview-content {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* ===== Enhanced Payment Modal ===== */
        .payment-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .payment-method {
            border: 2px solid var(--border-light);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .payment-method:hover {
            border-color: var(--accent-blue);
            background: rgba(0, 122, 204, 0.05);
        }

        .payment-method.active {
            border-color: var(--accent-blue);
            background: rgba(0, 122, 204, 0.1);
        }

        .card-details {
            display: none;
            margin-top: 1rem;
            animation: fadeIn 0.3s ease;
        }

        .card-details.active {
            display: block;
        }

        /* ===== Modal System ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .modal {
            background: var(--card-bg);
            border: 1px solid var(--border-light);
            border-radius: 24px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: var(--shadow-xl);
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            padding: 2rem;
            border-bottom: 1px solid var(--border-light);
            position: relative;
            text-align: center;
        }

        .modal-title {
            font-size: 1.75rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .modal-close {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            color: var(--accent-blue);
            border-color: var(--accent-blue);
        }

        .modal-body {
            padding: 2rem;
        }

        /* ===== Forms ===== */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(0, 122, 204, 0.1);
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .centered-form {
            max-width: 500px;
            margin: 0 auto;
            text-align: center;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            justify-content: center;
        }

        .form-switch {
            text-align: center;
            margin-top: 1.5rem;
            color: var(--text-secondary);
        }

        .form-switch a {
            color: var(--accent-blue);
            cursor: pointer;
            text-decoration: none;
        }

        /* ===== Footer ===== */
        .footer {
            background: var(--secondary-bg);
            padding: 4rem 0 2rem;
            border-top: 1px solid var(--border-light);
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 3rem;
            margin-bottom: 3rem;
        }

        .footer-section h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 0.75rem;
        }

        .footer-links a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .footer-links a:hover {
            color: var(--accent-blue);
        }

        .footer-bottom {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid var(--border-light);
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* ===== Toast Notifications ===== */
        .toast-container {
            position: fixed;
            top: 100px;
            right: 20px;
            z-index: 9999;
        }

        .toast {
            background: var(--card-bg);
            border: 1px solid var(--border-light);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast.success {
            border-left: 4px solid var(--accent-green);
        }

        .toast.error {
            border-left: 4px solid #ef4444;
        }

        .toast.warning {
            border-left: 4px solid var(--accent-orange);
        }

        /* ===== Responsive Design ===== */
        @media (max-width: 1200px) {
            .hero-title {
                font-size: 4rem;
            }
            .books-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
            .admin-panel {
                grid-template-columns: 1fr;
            }
            .code-editor-container {
                grid-template-columns: 1fr;
                height: 120vh;
            }
            .nav-links {
                gap: 1rem;
            }
        }

        @media (max-width: 992px) {
            .navbar {
                flex-wrap: wrap;
            }
            .nav-links {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                width: 100%;
                background: rgba(10, 10, 15, 0.95);
                backdrop-filter: blur(20px);
                flex-direction: column;
                padding: 1rem;
                border-top: 1px solid rgba(255, 255, 255, 0.05);
                box-shadow: var(--shadow-xl);
            }
            .nav-links.active {
                display: flex;
            }
            .nav-link {
                padding: 15px 20px;
                justify-content: flex-start;
            }
            .mobile-menu-btn {
                display: block;
            }
            .search-box {
                order: 3;
                width: 100%;
                margin-top: 1rem;
            }
            .hero-title {
                font-size: 3rem;
            }
            .section-title {
                font-size: 2.5rem;
            }
            .form-grid {
                grid-template-columns: 1fr;
            }
            .book-actions {
                grid-template-columns: 1fr;
            }
            .book-actions button {
                width: 100%;
                justify-content: center;
            }
            .profile-avatar {
                width: 120px;
                height: 120px;
            }
        }

        @media (max-width: 768px) {
            .header-actions {
                width: 100%;
                justify-content: space-between;
            }
            .search-box {
                width: calc(100% - 100px);
            }
            .hero-title {
                font-size: 2.5rem;
            }
            .hero-stats {
                gap: 2rem;
            }
            .stat-number {
                font-size: 2rem;
            }
            .cta-buttons {
                flex-direction: column;
                align-items: center;
            }
            .btn {
                width: 100%;
                justify-content: center;
            }
            .filters-grid {
                grid-template-columns: 1fr;
            }
            .modal {
                width: 95%;
                margin: 1rem;
            }
            .code-editor-container {
                height: auto;
                min-height: 500px;
            }
            .editor-toolbar {
                flex-direction: column;
                align-items: stretch;
            }
            .editor-toolbar select,
            .editor-toolbar button {
                width: 100%;
            }
            .chat-container {
                width: 90%;
                right: 5%;
                height: 400px;
            }
        }

        @media (max-width: 480px) {
            .hero-title {
                font-size: 2rem;
            }
            .section-title {
                font-size: 2rem;
            }
            .book-card {
                min-width: 0;
            }
            .profile-avatar {
                width: 100px;
                height: 100px;
            }
            .profile-avatar .avatar-placeholder {
                font-size: 2rem;
            }
            .avatar-upload-btn {
                width: 30px;
                height: 30px;
                bottom: 5px;
                right: 5px;
            }
            .admin-panel {
                gap: 1rem;
            }
            .admin-sidebar {
                padding: 1rem;
            }
            .admin-content {
                padding: 1rem;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .cookie-consent {
                left: 10px;
                right: 10px;
                bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Background Effects -->
    <div class="bg-effects">
        <div class="gradient-circle circle-1"></div>
        <div class="gradient-circle circle-2"></div>
        <div class="grid-pattern"></div>
    </div>

    <!-- Cookies Consent -->
    <div id="cookieConsent" class="cookie-consent">
        <div class="cookie-content">
            <span class="material-symbols-rounded">cookie</span>
            <p>We use cookies to enhance your experience. By continuing to visit this site you agree to our use of cookies.</p>
            <div class="cookie-actions">
                <button class="btn btn-primary" id="acceptCookies">Accept</button>
                <button class="btn btn-secondary" id="rejectCookies">Reject</button>
                <a href="#" class="cookie-link" onclick="app.showCookieInfo()">Learn More</a>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <nav class="navbar">
                <a href="#" class="logo">
                    <div class="logo-icon">
                        <span class="material-symbols-rounded">code</span>
                    </div>
                    <span class="logo-text">BetterProgrammer</span>
                </a>
                <button class="mobile-menu-btn" id="mobileMenuBtn">
                    <span class="material-symbols-rounded">menu</span>
                </button>
                <ul class="nav-links" id="navLinks">
                    <li><a href="#" class="nav-link active" data-page="home">
                        <span class="material-symbols-rounded">home</span>
                        Home
                    </a></li>
                    <li><a href="#" class="nav-link" data-page="books">
                        <span class="material-symbols-rounded">menu_book</span>
                        Books
                    </a></li>
                    <li><a href="#" class="nav-link" data-page="categories">
                        <span class="material-symbols-rounded">category</span>
                        Categories
                    </a></li>
                    <li><a href="#" class="nav-link" data-page="faq">
                        <span class="material-symbols-rounded">help</span>
                        FAQ
                    </a></li>
                    <li><a href="#" class="nav-link" data-page="profile">
                        <span class="material-symbols-rounded">person</span>
                        Profile
                    </a></li>
                    <li><a href="#" class="nav-link" data-page="codeEditor">
                        <span class="material-symbols-rounded">code_blocks</span>
                        Code Editor
                    </a></li>
                    <li><a href="#" class="nav-link" data-page="adminPanel" id="adminNavLink" style="display: none;">
                        <span class="material-symbols-rounded">admin_panel_settings</span>
                        Admin
                    </a></li>
                </ul>
                <div class="header-actions">
                    <div class="search-box">
                        <input type="text" class="search-input" placeholder="Search books..." id="searchInput">
                        <span class="material-symbols-rounded search-icon">search</span>
                    </div>
                    <button class="chat-btn" id="chatBtn">
                        <span class="material-symbols-rounded">chat</span>
                        <span class="chat-badge" id="chatBadge">0</span>
                    </button>
                    <button class="cart-btn" id="cartBtn">
                        <span class="material-symbols-rounded">shopping_cart</span>
                        <span class="cart-count" id="cartCount">0</span>
                    </button>
                    <button class="auth-btn" id="authBtn">Sign In</button>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content Container -->
    <main id="mainContent">
        <!-- Home Page -->
        <section class="page active" id="homePage">
            <div class="hero">
                <div class="container">
                    <div class="hero-content">
                        <h1 class="hero-title">Master Programming with Premium E-Books</h1>
                        <p class="hero-subtitle">
                            Access the largest collection of programming books written by industry experts.
                            From beginner tutorials to advanced algorithms, everything you need to level up your skills.
                        </p>
                        <div class="hero-stats">
                            <div class="stat-item">
                                <div class="stat-number" id="totalBooks">500+</div>
                                <div class="stat-label">E-Books</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="totalAuthors">150+</div>
                                <div class="stat-label">Expert Authors</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="activeReaders">10K+</div>
                                <div class="stat-label">Active Readers</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="avgRating">4.8</div>
                                <div class="stat-label">Avg Rating</div>
                            </div>
                        </div>
                        <div class="cta-buttons">
                            <button class="btn btn-primary" id="exploreBtn">
                                <span class="material-symbols-rounded">explore</span>
                                Explore Library
                            </button>
                            <button class="btn btn-secondary" id="joinFreeBtn">
                                <span class="material-symbols-rounded">person_add</span>
                                Join Free
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Books Page -->
        <section class="page books-section" id="booksPage">
            <div class="container">
                <div class="books-header">
                    <h2 class="section-title">Programming E-Books Collection</h2>
                    <p class="section-subtitle">Browse our curated collection of programming books. Filter by category, difficulty, or price range.</p>
                </div>
                <!-- Filters -->
                <div class="filters-container">
                    <div class="filters-grid">
                        <div class="filter-group">
                            <label class="filter-label">
                                <span class="material-symbols-rounded">category</span>
                                Category
                            </label>
                            <select class="filter-select" id="categoryFilter">
                                <option value="all">All Categories</option>
                                <option value="web">Web Development</option>
                                <option value="mobile">Mobile Development</option>
                                <option value="data">Data Science</option>
                                <option value="ai">AI & Machine Learning</option>
                                <option value="devops">DevOps</option>
                                <option value="algorithms">Algorithms</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">
                                <span class="material-symbols-rounded">attach_money</span>
                                Price Range
                            </label>
                            <select class="filter-select" id="priceFilter">
                                <option value="all">All Prices</option>
                                <option value="free">Free Only</option>
                                <option value="paid">Paid Only</option>
                                <option value="under-20">Under $20</option>
                                <option value="20-50">$20 - $50</option>
                                <option value="over-50">Over $50</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">
                                <span class="material-symbols-rounded">sort</span>
                                Sort By
                            </label>
                            <select class="filter-select" id="sortFilter">
                                <option value="popular">Most Popular</option>
                                <option value="newest">Newest First</option>
                                <option value="rating">Highest Rated</option>
                                <option value="price-low">Price: Low to High</option>
                                <option value="price-high">Price: High to Low</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">
                                <span class="material-symbols-rounded">school</span>
                                Difficulty
                            </label>
                            <select class="filter-select" id="difficultyFilter">
                                <option value="all">All Levels</option>
                                <option value="beginner">Beginner</option>
                                <option value="intermediate">Intermediate</option>
                                <option value="advanced">Advanced</option>
                            </select>
                        </div>
                    </div>
                    <div class="filter-actions">
                        <button class="btn btn-secondary" id="resetFilters">
                            <span class="material-symbols-rounded">restart_alt</span>
                            Reset Filters
                        </button>
                    </div>
                </div>
                <!-- Books Grid -->
                <div class="books-grid" id="booksGrid">
                    <!-- Books will be loaded dynamically -->
                </div>
                <!-- Load More Button -->
                <div style="text-align: center; margin-top: 3rem;">
                    <button class="btn btn-secondary" id="loadMoreBtn">
                        <span class="material-symbols-rounded">expand_more</span>
                        Load More Books
                    </button>
                </div>
            </div>
        </section>

        <!-- Categories Page -->
        <section class="page" id="categoriesPage">
            <div class="container section">
                <h2 class="section-title">Book Categories</h2>
                <p class="section-subtitle">Explore programming books by category to find exactly what you're looking for.</p>
                <div class="categories-grid" id="categoriesGrid">
                    <!-- Categories will be loaded dynamically -->
                </div>
            </div>
        </section>

        <!-- FAQ Page -->
        <section class="page" id="faqPage">
            <div class="container section">
                <h2 class="section-title">Frequently Asked Questions</h2>
                <p class="section-subtitle">Find answers to common questions about our e-book library and services.</p>
                <div class="faq-container" id="faqContainer">
                    <!-- FAQ items will be loaded dynamically -->
                </div>
            </div>
        </section>

        <!-- Profile Page -->
        <section class="page" id="profilePage">
            <div class="container section">
                <div class="profile-header">
                    <div class="profile-avatar" id="profileAvatar">
                        <div class="avatar-placeholder">
                            <span class="material-symbols-rounded">person</span>
                        </div>
                        <div class="avatar-upload-btn" id="avatarUploadBtn">
                            <span class="material-symbols-rounded">photo_camera</span>
                        </div>
                    </div>
                    <h2 class="section-title">My Profile</h2>
                    <p class="section-subtitle">View and manage your account information</p>
                </div>
                <div class="profile-info" id="profileInfo">
                    <!-- Profile info will be loaded dynamically -->
                </div>
                <div style="text-align: center; margin-top: 2rem;">
                    <button class="btn btn-secondary" id="editProfileBtn">
                        <span class="material-symbols-rounded">edit</span>
                        Edit Profile
                    </button>
                    <button class="btn btn-primary" id="myBooksBtn">
                        <span class="material-symbols-rounded">library_books</span>
                        My Purchased Books
                    </button>
                </div>
            </div>
        </section>

        <!-- Code Editor Page -->
        <section class="page" id="codeEditorPage">
            <div class="container section">
                <h2 class="section-title">VS Code Style Editor</h2>
                <p class="section-subtitle">Write, test, and preview your code in real-time with VS Code-like experience.</p>
                <div class="code-editor-container">
                    <div class="code-editor-section">
                        <h3>Code Editor</h3>
                        <div class="editor-toolbar">
                            <select class="form-input" id="languageSelect" style="width: 150px;">
                                <option value="javascript">JavaScript</option>
                                <option value="html">HTML</option>
                                <option value="css">CSS</option>
                                <option value="python">Python</option>
                                <option value="java">Java</option>
                                <option value="php">PHP</option>
                                <option value="cpp">C++</option>
                            </select>
                            <button class="btn btn-secondary btn-small" id="clearCodeBtn">
                                <span class="material-symbols-rounded">delete</span>
                                Clear
                            </button>
                            <button class="btn btn-primary btn-small" id="runCodeBtn">
                                <span class="material-symbols-rounded">play_arrow</span>
                                Run Code
                            </button>
                            <button class="btn btn-secondary btn-small" id="saveCodeBtn">
                                <span class="material-symbols-rounded">save</span>
                                Save
                            </button>
                            <button class="btn btn-secondary btn-small" id="formatCodeBtn">
                                <span class="material-symbols-rounded">format_ink_highlighter</span>
                                Format
                            </button>
                        </div>
                        <div class="editor-container">
                            <textarea id="codeEditor" style="display: none;"></textarea>
                        </div>
                    </div>
                    <div class="preview-section">
                        <h3>Live Preview</h3>
                        <div class="preview-container">
                            <iframe id="previewFrame" class="preview-content"></iframe>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 2rem;">
                    <h3 style="margin-bottom: 1rem;">Saved Code Snippets</h3>
                    <div id="savedSnippets" style="background: var(--card-bg); border: 1px solid var(--border-light); border-radius: 12px; padding: 1.5rem; min-height: 100px;">
                        <!-- Saved snippets will appear here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Admin Panel -->
        <section class="page" id="adminPanelPage">
            <div class="container section">
                <h2 class="section-title">Admin Dashboard</h2>
                <p class="section-subtitle">Manage all aspects of the website with full control and privileges.</p>
                <div class="admin-panel">
                    <div class="admin-sidebar">
                        <h3>Admin Menu</h3>
                        <ul class="admin-menu">
                            <li><a href="#" data-admin-section="dashboard" class="active">
                                <span class="material-symbols-rounded">dashboard</span>
                                Dashboard
                            </a></li>
                            <li><a href="#" data-admin-section="books">
                                <span class="material-symbols-rounded">menu_book</span>
                                Books Management
                            </a></li>
                            <li><a href="#" data-admin-section="users">
                                <span class="material-symbols-rounded">people</span>
                                Users Management
                            </a></li>
                            <li><a href="#" data-admin-section="categories">
                                <span class="material-symbols-rounded">category</span>
                                Categories
                            </a></li>
                            <li><a href="#" data-admin-section="orders">
                                <span class="material-symbols-rounded">shopping_cart</span>
                                Orders
                            </a></li>
                            <li><a href="#" data-admin-section="settings">
                                <span class="material-symbols-rounded">settings</span>
                                Settings
                            </a></li>
                        </ul>
                    </div>
                    <div class="admin-content">
                        <!-- Dashboard Section -->
                        <div class="admin-section active" id="adminDashboard">
                            <h3 style="margin-bottom: 1.5rem;">System Overview</h3>
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-card-number" id="totalBooksCount">0</div>
                                    <div class="stat-card-label">Total Books</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-card-number" id="totalUsersCount">0</div>
                                    <div class="stat-card-label">Total Users</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-card-number" id="totalOrdersCount">0</div>
                                    <div class="stat-card-label">Total Orders</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-card-number" id="totalRevenue">$0</div>
                                    <div class="stat-card-label">Total Revenue</div>
                                </div>
                            </div>
                            <div style="margin-top: 2rem;">
                                <h3 style="margin-bottom: 1rem;">Recent Activity</h3>
                                <div id="recentActivity" style="background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 1.5rem; min-height: 200px;">
                                    <!-- Recent activity will be loaded here -->
                                </div>
                            </div>
                        </div>

                        <!-- Books Management Section -->
                        <div class="admin-section" id="adminBooks">
                            <h3 style="margin-bottom: 1.5rem;">Books Management</h3>
                            <div class="admin-actions">
                                <button class="btn btn-primary" id="adminAddBookBtn">
                                    <span class="material-symbols-rounded">add</span>
                                    Add New Book
                                </button>
                                <button class="btn btn-secondary" id="adminImportBooksBtn">
                                    <span class="material-symbols-rounded">upload</span>
                                    Import Books
                                </button>
                                <button class="btn btn-secondary" id="adminExportBooksBtn">
                                    <span class="material-symbols-rounded">download</span>
                                    Export Books
                                </button>
                            </div>
                            <div class="books-list" style="margin-top: 2rem;">
                                <div id="adminBooksList">
                                    <!-- Books will be loaded here -->
                                </div>
                            </div>
                        </div>

                        <!-- Users Management Section -->
                        <div class="admin-section" id="adminUsers">
                            <h3 style="margin-bottom: 1.5rem;">Users Management</h3>
                            <div style="margin-bottom: 1.5rem;">
                                <input type="text" class="form-input" id="searchUsers" placeholder="Search users...">
                            </div>
                            <div id="usersList">
                                <!-- Users will be loaded here -->
                            </div>
                        </div>

                        <!-- Categories Section -->
                        <div class="admin-section" id="adminCategories">
                            <h3 style="margin-bottom: 1.5rem;">Categories Management</h3>
                            <div id="categoriesManagement">
                                <!-- Categories management will be loaded here -->
                            </div>
                        </div>

                        <!-- Orders Section -->
                        <div class="admin-section" id="adminOrders">
                            <h3 style="margin-bottom: 1.5rem;">Orders Management</h3>
                            <div id="ordersList">
                                <!-- Orders will be loaded here -->
                            </div>
                        </div>

                        <!-- Settings Section -->
                        <div class="admin-section" id="adminSettings">
                            <h3 style="margin-bottom: 1.5rem;">System Settings</h3>
                            <form id="adminSettingsForm">
                                <div class="form-group">
                                    <label class="form-label">
                                        <span class="material-symbols-rounded">store</span>
                                        Site Name
                                    </label>
                                    <input type="text" class="form-input" id="siteName" value="Better Programmer">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">
                                        <span class="material-symbols-rounded">description</span>
                                        Site Description
                                    </label>
                                    <textarea class="form-input" id="siteDescription" rows="3">Premium Programming E-Books Library</textarea>
                                </div>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label class="form-label">
                                            <span class="material-symbols-rounded">attach_money</span>
                                            Default Currency
                                        </label>
                                        <select class="form-input" id="defaultCurrency">
                                            <option value="USD">USD ($)</option>
                                            <option value="EUR">EUR ()</option>
                                            <option value="GBP">GBP ()</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">
                                            <span class="material-symbols-rounded">language</span>
                                            Default Language
                                        </label>
                                        <select class="form-input" id="defaultLanguage">
                                            <option value="en">English</option>
                                            <option value="ge">Georgian</option>
                                            <option value="ru">Russian</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-primary">
                                        <span class="material-symbols-rounded">save</span>
                                        Save Settings
                                    </button>
                                    <button type="button" class="btn btn-secondary" id="resetSettingsBtn">
                                        <span class="material-symbols-rounded">restart_alt</span>
                                        Reset to Default
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Book Detail Page -->
        <section class="page" id="bookDetailPage">
            <div class="container section">
                <div id="bookDetailContent">
                    <!-- Dynamic book detail content -->
                </div>
            </div>
        </section>
    </main>

    <!-- Chat Container -->
    <div class="chat-container" id="chatContainer">
        <div class="chat-header">
            <h3><span class="material-symbols-rounded">forum</span> Support Chat</h3>
            <button class="chat-close" id="chatClose">
                <span class="material-symbols-rounded">close</span>
            </button>
        </div>
        <div class="chat-messages" id="chatMessages">
            <!-- Messages will appear here -->
        </div>
        <div class="chat-input">
            <textarea id="chatInput" placeholder="Type your message..." rows="2"></textarea>
            <button id="sendMessage">
                <span class="material-symbols-rounded">send</span>
            </button>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Modal Overlay -->
    <div class="modal-overlay" id="modalOverlay"></div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Better Programmer</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                        Your premier destination for programming education.
                        Master the code, master the future.
                    </p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="#" onclick="app.navigateTo('home')"><span class="material-symbols-rounded">home</span> Home</a></li>
                        <li><a href="#" onclick="app.navigateTo('books')"><span class="material-symbols-rounded">menu_book</span> E-Books</a></li>
                        <li><a href="#" onclick="app.navigateTo('categories')"><span class="material-symbols-rounded">category</span> Categories</a></li>
                        <li><a href="#" onclick="app.navigateTo('faq')"><span class="material-symbols-rounded">help</span> FAQ</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Categories</h3>
                    <ul class="footer-links">
                        <li><a href="#" onclick="app.navigateTo('books'); app.setFilter('category', 'web')"><span class="material-symbols-rounded">code</span> Web Development</a></li>
                        <li><a href="#" onclick="app.navigateTo('books'); app.setFilter('category', 'mobile')"><span class="material-symbols-rounded">smartphone</span> Mobile Development</a></li>
                        <li><a href="#" onclick="app.navigateTo('books'); app.setFilter('category', 'data')"><span class="material-symbols-rounded">analytics</span> Data Science</a></li>
                        <li><a href="#" onclick="app.navigateTo('books'); app.setFilter('category', 'ai')"><span class="material-symbols-rounded">psychology</span> AI & ML</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Support</h3>
                    <ul class="footer-links">
                        <li><a href="#" onclick="app.navigateTo('faq')"><span class="material-symbols-rounded">contact_support</span> Help Center</a></li>
                        <li><a href="#"><span class="material-symbols-rounded">email</span> Contact Us</a></li>
                        <li><a href="#"><span class="material-symbols-rounded">policy</span> Privacy Policy</a></li>
                        <li><a href="#"><span class="material-symbols-rounded">description</span> Terms</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p> 2024 Better Programmer. All rights reserved.</p>
                <p style="margin-top: 0.5rem; color: var(--text-muted);">
                    Made with <span style="color: var(--accent-blue);"></span> for developers worldwide
                </p>
            </div>
        </div>
    </footer>

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/mode/clike/clike.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/mode/php/php.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/addon/hint/show-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/addon/hint/javascript-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.0/addon/format/formatting.min.js"></script>

    <script>
        class BetterProgrammerApp {
            constructor() {
                this.state = {
                    user: null,
                    books: [],
                    cart: [],
                    currentBookId: null,
                    filters: {
                        category: 'all',
                        price: 'all',
                        sort: 'popular',
                        difficulty: 'all',
                        search: ''
                    },
                    registeredUsers: new Set(),
                    codeEditor: null,
                    serverRunning: false,
                    userProfileImage: null,
                    cookiesAccepted: false,
                    adminUsers: [],
                    settings: {
                        siteName: 'Better Programmer',
                        siteDescription: 'Premium Programming E-Books Library',
                        defaultCurrency: 'USD',
                        defaultLanguage: 'en'
                    }
                };
                this.chatSystem = null;
                this.init();
            }

            init() {
                this.loadData();
                this.initUI();
                this.setupEventListeners();
                this.setupCookies();
                this.renderBooks();
                this.updateCartCount();
                this.renderCategories();
                this.renderFAQ();
                this.renderProfile();
                this.setupAdminPanel();
                this.setupCodeEditor();
                this.setupMobileMenu();
                this.setupChatSystem();
            }

            setupCookies() {
                const cookiesAccepted = localStorage.getItem('bp_cookies_accepted');
                if (cookiesAccepted === null) {
                    setTimeout(() => {
                        document.getElementById('cookieConsent').style.display = 'block';
                    }, 2000);
                } else {
                    this.state.cookiesAccepted = cookiesAccepted === 'true';
                }

                document.getElementById('acceptCookies').addEventListener('click', () => {
                    this.acceptCookies();
                });

                document.getElementById('rejectCookies').addEventListener('click', () => {
                    this.rejectCookies();
                });
            }

            acceptCookies() {
                this.state.cookiesAccepted = true;
                localStorage.setItem('bp_cookies_accepted', 'true');
                document.getElementById('cookieConsent').style.display = 'none';
                this.showToast('Cookies accepted', 'success');
            }

            rejectCookies() {
                this.state.cookiesAccepted = false;
                localStorage.setItem('bp_cookies_accepted', 'false');
                document.getElementById('cookieConsent').style.display = 'none';
                this.showToast('Cookies rejected', 'info');
            }

            showCookieInfo() {
                this.showToast('We use cookies for analytics and user experience improvements.', 'info');
            }

            setupMobileMenu() {
                const mobileMenuBtn = document.getElementById('mobileMenuBtn');
                const navLinks = document.getElementById('navLinks');
                mobileMenuBtn.addEventListener('click', () => {
                    navLinks.classList.toggle('active');
                    mobileMenuBtn.innerHTML = navLinks.classList.contains('active') ?
                        '<span class="material-symbols-rounded">close</span>' :
                        '<span class="material-symbols-rounded">menu</span>';
                });

                document.addEventListener('click', (e) => {
                    if (!navLinks.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
                        navLinks.classList.remove('active');
                        mobileMenuBtn.innerHTML = '<span class="material-symbols-rounded">menu</span>';
                    }
                });

                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', () => {
                        navLinks.classList.remove('active');
                        mobileMenuBtn.innerHTML = '<span class="material-symbols-rounded">menu</span>';
                    });
                });
            }

            setupChatSystem() {
                this.chatSystem = new ChatSystem(this);
            }

            loadData() {
                // Load user
                const savedUser = localStorage.getItem('bp_user');
                if (savedUser) {
                    this.state.user = JSON.parse(savedUser);
                }

                // Load cart
                const savedCart = localStorage.getItem('bp_cart');
                if (savedCart) {
                    this.state.cart = JSON.parse(savedCart);
                }

                // Load registered users
                const savedUsers = localStorage.getItem('bp_registered_users');
                if (savedUsers) {
                    this.state.registeredUsers = new Set(JSON.parse(savedUsers));
                } else {
                    this.state.registeredUsers.add('better');
                    this.saveRegisteredUsers();
                }

                // Load books
                const savedBooks = localStorage.getItem('bp_books');
                if (savedBooks) {
                    this.state.books = JSON.parse(savedBooks);
                } else {
                    this.state.books = this.getDefaultBooks();
                    this.saveBooks();
                }

                // Load profile image
                const savedProfileImage = localStorage.getItem('bp_user_profile_image');
                if (savedProfileImage) {
                    this.state.userProfileImage = savedProfileImage;
                }

                // Load admin users
                const savedAdminUsers = localStorage.getItem('bp_admin_users');
                if (savedAdminUsers) {
                    this.state.adminUsers = JSON.parse(savedAdminUsers);
                } else {
                    // Add default admin user
                    this.state.adminUsers = [{
                        id: 'admin-1',
                        email: 'better',
                        name: 'Admin User',
                        role: 'admin',
                        phone: '+995 123 456 789',
                        age: 30,
                        purchasedBooks: [],
                        blocked: false
                    }];
                    this.saveAdminUsers();
                }

                // Load settings
                const savedSettings = localStorage.getItem('bp_settings');
                if (savedSettings) {
                    this.state.settings = JSON.parse(savedSettings);
                }
            }

            getDefaultBooks() {
                return [
                    {
                        id: 'clean-code-' + Date.now(),
                        title: 'Clean Code: A Handbook of Agile Software Craftsmanship',
                        author: 'Robert C. Martin',
                        price: 29.99,
                        originalPrice: 39.99,
                        category: 'algorithms',
                        difficulty: 'intermediate',
                        rating: 4.7,
                        reviews: 1248,
                        description: 'Learn how to write clean, maintainable code that other developers will love to work with.',
                        longDescription: 'Even bad code can function. But if code isn\'t clean, it can bring a development organization to its knees.',
                        image: 'https://picsum.photos/400/600?random=1',
                        badges: ['popular', 'bestseller'],
                        pages: 464,
                        language: 'English',
                        published: '2008-08-01',
                        publisher: 'Prentice Hall',
                        topics: ['Software Architecture', 'Refactoring', 'Code Quality'],
                        previewContent: 'Chapter 1: Clean Code - What is clean code? This chapter introduces the concept of clean code and why it matters...'
                    },
                    {
                        id: 'eloquent-js-' + Date.now(),
                        title: 'Eloquent JavaScript',
                        author: 'Marijn Haverbeke',
                        price: 0,
                        category: 'web',
                        difficulty: 'beginner',
                        rating: 4.6,
                        reviews: 856,
                        description: 'A modern introduction to programming using JavaScript. Learn the fundamentals and advanced concepts.',
                        longDescription: 'This is a book about JavaScript, programming, and the wonders of the digital.',
                        image: 'https://picsum.photos/400/600?random=2',
                        badges: ['free', 'new'],
                        pages: 472,
                        language: 'English',
                        published: '2018-12-04',
                        publisher: 'No Starch Press',
                        topics: ['JavaScript', 'Web Development', 'Programming Basics'],
                        previewContent: 'Introduction: Welcome to the world of JavaScript. This book will guide you through the language...'
                    },
                    {
                        id: 'pragmatic-' + Date.now(),
                        title: 'The Pragmatic Programmer',
                        author: 'David Thomas & Andrew Hunt',
                        price: 39.99,
                        originalPrice: 49.99,
                        category: 'web',
                        difficulty: 'intermediate',
                        rating: 4.8,
                        reviews: 956,
                        description: 'Your journey to mastery, from apprentice to master craftsman.',
                        longDescription: 'The Pragmatic Programmer is one of those rare tech books you\'ll read, re-read, and read again.',
                        image: 'https://picsum.photos/400/600?random=3',
                        badges: ['popular'],
                        pages: 352,
                        language: 'English',
                        published: '2019-09-13',
                        publisher: 'Addison-Wesley',
                        topics: ['Software Engineering', 'Career Development', 'Best Practices'],
                        previewContent: 'Chapter 1: A Pragmatic Philosophy - This chapter sets the tone for the entire book...'
                    }
                ];
            }

            initUI() {
                this.updateAuthButton();
                this.updateAdminNav();
                this.updateProfileImage();
            }

            setupEventListeners() {
                // Navigation
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const page = link.dataset.page;
                        this.navigateTo(page);
                    });
                });

                // Explore button
                document.getElementById('exploreBtn').addEventListener('click', () => {
                    this.navigateTo('books');
                });

                // Join free button
                document.getElementById('joinFreeBtn').addEventListener('click', () => {
                    this.showSignupModal();
                });

                // Auth button
                document.getElementById('authBtn').addEventListener('click', () => {
                    if (this.state.user) {
                        this.logout();
                    } else {
                        this.showAuthModal();
                    }
                });

                // Cart button
                document.getElementById('cartBtn').addEventListener('click', () => {
                    this.showCart();
                });

                // Chat button
                document.getElementById('chatBtn').addEventListener('click', () => {
                    this.chatSystem.toggleChat();
                });

                // Search
                document.getElementById('searchInput').addEventListener('input', (e) => {
                    this.state.filters.search = e.target.value;
                    this.filterAndRenderBooks();
                });

                // Filters
                document.getElementById('categoryFilter').addEventListener('change', (e) => {
                    this.state.filters.category = e.target.value;
                    this.filterAndRenderBooks();
                });

                document.getElementById('priceFilter').addEventListener('change', (e) => {
                    this.state.filters.price = e.target.value;
                    this.filterAndRenderBooks();
                });

                document.getElementById('sortFilter').addEventListener('change', (e) => {
                    this.state.filters.sort = e.target.value;
                    this.filterAndRenderBooks();
                });

                document.getElementById('difficultyFilter').addEventListener('change', (e) => {
                    this.state.filters.difficulty = e.target.value;
                    this.filterAndRenderBooks();
                });

                // Reset filters
                document.getElementById('resetFilters').addEventListener('click', () => {
                    this.resetFilters();
                });

                // Load more button
                document.getElementById('loadMoreBtn').addEventListener('click', () => {
                    this.loadMoreBooks();
                });

                // Profile buttons
                document.getElementById('editProfileBtn').addEventListener('click', () => {
                    this.showEditProfileModal();
                });

                document.getElementById('avatarUploadBtn').addEventListener('click', () => {
                    this.showAvatarUploadModal();
                });

                document.getElementById('myBooksBtn').addEventListener('click', () => {
                    this.showMyBooks();
                });

                // Modal overlay
                document.getElementById('modalOverlay').addEventListener('click', (e) => {
                    if (e.target === document.getElementById('modalOverlay')) {
                        this.closeModal();
                    }
                });

                // Escape key
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.closeModal();
                    }
                });
            }

            setupCodeEditor() {
                const textarea = document.getElementById('codeEditor');
                this.state.codeEditor = CodeMirror.fromTextArea(textarea, {
                    mode: 'javascript',
                    theme: 'vs-dark',
                    lineNumbers: true,
                    autofocus: true,
                    indentUnit: 4,
                    tabSize: 4,
                    lineWrapping: true,
                    matchBrackets: true,
                    autoCloseBrackets: true,
                    extraKeys: {
                        'Ctrl-Space': 'autocomplete',
                        'Ctrl-S': () => this.saveCodeSnippet(),
                        'Ctrl-Enter': () => this.runCode(),
                        'Ctrl-Alt-L': () => this.formatCode(),
                        'Tab': 'indentMore',
                        'Shift-Tab': 'indentLess'
                    }
                });

                this.state.codeEditor.setValue(`// Welcome to Better Programmer VS Code Style Editor!
// Write your code here and click "Run Code" to see the result.

function greet(name) {
    return \`Hello, \${name}! Welcome to Better Programmer.\`;
}

console.log(greet("Developer"));`);

                // Code editor buttons
                document.getElementById('clearCodeBtn').addEventListener('click', () => {
                    if (confirm('Clear all code?')) {
                        this.state.codeEditor.setValue('');
                    }
                });

                document.getElementById('runCodeBtn').addEventListener('click', () => {
                    this.runCode();
                });

                document.getElementById('saveCodeBtn').addEventListener('click', () => {
                    this.saveCodeSnippet();
                });

                document.getElementById('formatCodeBtn').addEventListener('click', () => {
                    this.formatCode();
                });

                document.getElementById('languageSelect').addEventListener('change', (e) => {
                    const mode = this.getCodeMirrorMode(e.target.value);
                    this.state.codeEditor.setOption('mode', mode);
                });

                this.loadSavedSnippets();
            }

            getCodeMirrorMode(language) {
                const modes = {
                    'javascript': 'javascript',
                    'html': 'htmlmixed',
                    'css': 'css',
                    'python': 'python',
                    'java': 'text/x-java',
                    'php': 'php',
                    'cpp': 'text/x-c++src'
                };
                return modes[language] || 'javascript';
            }

            runCode() {
                const code = this.state.codeEditor.getValue();
                const language = document.getElementById('languageSelect').value;
                const previewFrame = document.getElementById('previewFrame');

                try {
                    if (language === 'html') {
                        previewFrame.contentDocument.open();
                        previewFrame.contentDocument.write(code);
                        previewFrame.contentDocument.close();
                    } else if (language === 'javascript') {
                        const html = `
                            <!DOCTYPE html>
                            <html>
                            <head>
                                <style>
                                    body {
                                        background: #1e1e1e;
                                        color: #d4d4d4;
                                        padding: 20px;
                                        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
                                    }
                                    .console {
                                        background: #252526;
                                        border: 1px solid #2d2d30;
                                        border-radius: 8px;
                                        padding: 15px;
                                        margin-top: 20px;
                                        font-family: monospace;
                                        color: #94a3b8;
                                    }
                                    .output {
                                        background: #252526;
                                        border: 1px solid #2d2d30;
                                        border-radius: 8px;
                                        padding: 15px;
                                        margin-top: 10px;
                                    }
                                </style>
                            </head>
                            <body>
                                <h3 style="color: #007acc;">JavaScript Output:</h3>
                                <div class="output" id="output"></div>
                                <div class="console" id="console"></div>
                                <script>
                                    const originalLog = console.log;
                                    const originalError = console.error;
                                    const outputDiv = document.getElementById('output');
                                    const consoleDiv = document.getElementById('console');
                                  
                                    console.log = function(...args) {
                                        originalLog.apply(console, args);
                                        const message = args.map(arg =>
                                            typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
                                        ).join(' ');
                                        const logEntry = document.createElement('div');
                                        logEntry.style.color = '#4ec9b0';
                                        logEntry.textContent = '> ' + message;
                                        consoleDiv.appendChild(logEntry);
                                    };
                                  
                                    console.error = function(...args) {
                                        originalError.apply(console, args);
                                        const message = args.map(arg =>
                                            typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
                                        ).join(' ');
                                        const errorEntry = document.createElement('div');
                                        errorEntry.style.color = '#f85149';
                                        errorEntry.textContent = ' ' + message;
                                        consoleDiv.appendChild(errorEntry);
                                    };
                                  
                                    try {
                                        ${code}
                                    } catch(error) {
                                        console.error('Error:', error.message);
                                    }
                                <\/script>
                            </body>
                            </html>
                        `;
                        previewFrame.contentDocument.open();
                        previewFrame.contentDocument.write(html);
                        previewFrame.contentDocument.close();
                    } else if (language === 'css') {
                        const html = `
                            <!DOCTYPE html>
                            <html>
                            <head>
                                <style>${code}</style>
                                <style>
                                    body {
                                        background: #1e1e1e;
                                        color: #d4d4d4;
                                        padding: 20px;
                                        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
                                    }
                                    .preview-area {
                                        padding: 20px;
                                        border: 1px solid #2d2d30;
                                        border-radius: 8px;
                                        margin-top: 20px;
                                        background: #252526;
                                    }
                                </style>
                            </head>
                            <body>
                                <h3 style="color: #007acc;">CSS Preview</h3>
                                <div class="preview-area">
                                    <h1 style="color: #c586c0;">Styled Heading</h1>
                                    <div class="box" style="width: 200px; height: 200px; background: linear-gradient(45deg, #007acc, #c586c0); margin: 20px 0; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">Styled Box</div>
                                    <p>Your CSS is being applied to this preview.</p>
                                </div>
                            </body>
                            </html>
                        `;
                        previewFrame.contentDocument.open();
                        previewFrame.contentDocument.write(html);
                        previewFrame.contentDocument.close();
                    } else {
                        previewFrame.contentDocument.open();
                        previewFrame.contentDocument.write(`
                            <!DOCTYPE html>
                            <html>
                            <body style="background: #1e1e1e; color: #d4d4d4; padding: 20px; font-family: 'Consolas', 'Monaco', 'Courier New', monospace;">
                                <h3 style="color: #007acc;">${language.toUpperCase()} Code Preview</h3>
                                <pre style="background: #252526; padding: 15px; border-radius: 8px; border: 1px solid #2d2d30; overflow-x: auto;">${this.escapeHtml(code)}</pre>
                            </body>
                            </html>
                        `);
                        previewFrame.contentDocument.close();
                    }
                    this.showToast('Code executed successfully!', 'success');
                } catch (error) {
                    this.showToast('Error executing code: ' + error.message, 'error');
                }
            }

            formatCode() {
                const cursor = this.state.codeEditor.getCursor();
                this.state.codeEditor.autoFormatRange({
                    line: 0,
                    ch: 0
                }, {
                    line: this.state.codeEditor.lineCount(),
                    ch: 0
                });
                this.state.codeEditor.setCursor(cursor);
                this.showToast('Code formatted successfully!', 'success');
            }

            saveCodeSnippet() {
                const code = this.state.codeEditor.getValue();
                const language = document.getElementById('languageSelect').value;
                const timestamp = new Date().toLocaleString();

                if (!this.state.user) {
                    this.showToast('Please sign in to save code snippets', 'warning');
                    this.showAuthModal();
                    return;
                }

                const snippet = {
                    id: 'snippet-' + Date.now(),
                    code,
                    language,
                    timestamp,
                    userId: this.state.user.id
                };

                let savedSnippets = JSON.parse(localStorage.getItem('bp_code_snippets') || '[]');
                savedSnippets.push(snippet);
                localStorage.setItem('bp_code_snippets', JSON.stringify(savedSnippets));

                this.showToast('Code snippet saved!', 'success');
                this.loadSavedSnippets();
            }

            loadSavedSnippets() {
                const savedSnippets = JSON.parse(localStorage.getItem('bp_code_snippets') || '[]');
                const container = document.getElementById('savedSnippets');

                if (savedSnippets.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                            <span class="material-symbols-rounded" style="font-size: 3rem; margin-bottom: 1rem; color: #007acc;">code_off</span>
                            <p>No saved code snippets yet. Write some code and click "Save"!</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem;">
                        ${savedSnippets.slice(-6).reverse().map(snippet => `
                            <div style="background: #252526; border: 1px solid #2d2d30; border-radius: 8px; padding: 1rem;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                    <span class="badge badge-popular" style="padding: 2px 8px; background: #007acc;">${snippet.language}</span>
                                    <div style="color: #94a3b8; font-size: 0.8rem;">${snippet.timestamp}</div>
                                </div>
                                <pre style="color: #d4d4d4; font-size: 0.85rem; overflow: hidden; text-overflow: ellipsis; max-height: 100px; background: #1e1e1e; padding: 8px; border-radius: 4px; font-family: 'Consolas', monospace;">${this.escapeHtml(snippet.code.substring(0, 200))}${snippet.code.length > 200 ? '...' : ''}</pre>
                                <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                                    <button class="btn btn-secondary" onclick="app.loadSnippet('${snippet.id}')" style="padding: 4px 8px; font-size: 0.8rem; background: #2d2d30; border-color: #2d2d30;">
                                        <span class="material-symbols-rounded" style="font-size: 1rem;">open_in_new</span>
                                        Load
                                    </button>
                                    <button class="btn btn-secondary" onclick="app.deleteSnippet('${snippet.id}')" style="padding: 4px 8px; font-size: 0.8rem; background: #2d2d30; border-color: #2d2d30;">
                                        <span class="material-symbols-rounded" style="font-size: 1rem;">delete</span>
                                        Delete
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            loadSnippet(snippetId) {
                const savedSnippets = JSON.parse(localStorage.getItem('bp_code_snippets') || '[]');
                const snippet = savedSnippets.find(s => s.id === snippetId);
                if (snippet) {
                    this.state.codeEditor.setValue(snippet.code);
                    document.getElementById('languageSelect').value = snippet.language;
                    const mode = this.getCodeMirrorMode(snippet.language);
                    this.state.codeEditor.setOption('mode', mode);
                    this.showToast('Code snippet loaded!', 'success');
                }
            }

            deleteSnippet(snippetId) {
                if (confirm('Delete this code snippet?')) {
                    let savedSnippets = JSON.parse(localStorage.getItem('bp_code_snippets') || '[]');
                    savedSnippets = savedSnippets.filter(s => s.id !== snippetId);
                    localStorage.setItem('bp_code_snippets', JSON.stringify(savedSnippets));
                    this.loadSavedSnippets();
                    this.showToast('Code snippet deleted', 'success');
                }
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            setupAdminPanel() {
                // Admin sidebar navigation
                document.querySelectorAll('.admin-menu a').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const section = link.dataset.adminSection;
                        this.showAdminSection(section);
                        document.querySelectorAll('.admin-menu a').forEach(a => {
                            a.classList.remove('active');
                        });
                        link.classList.add('active');
                    });
                });

                // Admin buttons
                document.getElementById('adminAddBookBtn')?.addEventListener('click', () => {
                    this.showAddBookModal();
                });

                document.getElementById('adminImportBooksBtn')?.addEventListener('click', () => {
                    this.importBooks();
                });

                document.getElementById('adminExportBooksBtn')?.addEventListener('click', () => {
                    this.exportBooks();
                });

                document.getElementById('searchUsers')?.addEventListener('input', (e) => {
                    this.searchUsers(e.target.value);
                });

                document.getElementById('adminSettingsForm')?.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveAdminSettings();
                });

                document.getElementById('resetSettingsBtn')?.addEventListener('click', () => {
                    this.resetAdminSettings();
                });

                // Load admin data
                this.loadAdminData();
            }

            showAdminSection(sectionId) {
                document.querySelectorAll('.admin-section').forEach(section => {
                    section.classList.remove('active');
                });
                document.getElementById('admin' + sectionId.charAt(0).toUpperCase() + sectionId.slice(1))?.classList.add('active');
            }

            loadAdminData() {
                // Load admin stats
                document.getElementById('totalBooksCount').textContent = this.state.books.length;
                document.getElementById('totalUsersCount').textContent = this.state.adminUsers.length;
                document.getElementById('totalOrdersCount').textContent = Math.floor(Math.random() * 500) + 100;
                document.getElementById('totalRevenue').textContent = '$' + (Math.random() * 10000 + 5000).toFixed(2);

                // Load admin books
                this.renderAdminBooks();
                // Load admin users
                this.loadAdminUsers();
                // Load admin categories
                this.loadAdminCategories();
                // Load admin orders
                this.loadAdminOrders();
                // Load recent activity
                this.loadRecentActivity();
            }

            loadAdminUsers() {
                const container = document.getElementById('usersList');
                container.innerHTML = `
                    <div style="background: rgba(255, 255, 255, 0.05); border-radius: 12px; overflow: hidden;">
                        ${this.state.adminUsers.map(user => `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; border-bottom: 1px solid var(--border-light);">
                                <div>
                                    <div style="font-weight: 600; color: var(--text-primary);">${user.name}</div>
                                    <div style="color: var(--text-secondary); font-size: 0.9rem;">${user.email}  ${user.role}</div>
                                    <div style="color: var(--text-muted); font-size: 0.8rem; margin-top: 0.25rem;">
                                        Purchased Books: ${user.purchasedBooks?.length || 0}
                                    </div>
                                </div>
                                <div style="display: flex; gap: 0.5rem;">
                                    <button class="btn btn-secondary" onclick="app.showUserBooks('${user.id}')" style="padding: 6px 12px; font-size: 0.8rem;">
                                        Books
                                    </button>
                                    ${user.role !== 'admin' ? `
                                        <button class="btn btn-secondary" onclick="app.grantBook('${user.id}')" style="padding: 6px 12px; font-size: 0.8rem;">
                                            Grant Book
                                        </button>
                                        <button class="btn btn-secondary" onclick="app.blockUser('${user.id}')" style="padding: 6px 12px; font-size: 0.8rem; color: ${user.blocked ? '#10b981' : '#ef4444'}">
                                            ${user.blocked ? 'Unblock' : 'Block'}
                                        </button>
                                        <button class="btn btn-secondary" onclick="app.deleteUser('${user.id}')" style="padding: 6px 12px; font-size: 0.8rem; color: #ef4444;">
                                            Delete
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            searchUsers(query) {
                this.showToast(`Searching for: ${query}`, 'info');
            }

            showUserBooks(userId) {
                const user = this.state.adminUsers.find(u => u.id === userId);
                const modalContent = `
                    <div class="modal">
                        <div class="modal-header">
                            <h2 class="modal-title">
                                <span class="material-symbols-rounded">library_books</span>
                                ${user.name}'s Purchased Books
                            </h2>
                            <div class="modal-close" onclick="app.closeModal()">
                                <span class="material-symbols-rounded">close</span>
                            </div>
                        </div>
                        <div class="modal-body">
                            ${user.purchasedBooks?.length ? 
                                user.purchasedBooks.map(bookId => {
                                    const book = this.state.books.find(b => b.id === bookId);
                                    return book ? `
                                        <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; border-bottom: 1px solid var(--border-light);">
                                            <img src="${book.image}" style="width: 50px; height: 65px; border-radius: 8px;" onerror="this.src='https://picsum.photos/400/600?book'">
                                            <div style="flex: 1;">
                                                <div style="font-weight: 600; color: var(--text-primary);">${book.title}</div>
                                                <div style="color: var(--text-secondary); font-size: 0.9rem;">by ${book.author}</div>
                                            </div>
                                            <div style="color: var(--accent-blue); font-weight: 600;">
                                                ${book.price === 0 ? 'FREE' : '$' + book.price.toFixed(2)}
                                            </div>
                                        </div>
                                    ` : '';
                                }).join('') : 
                                '<div style="text-align: center; padding: 2rem; color: var(--text-secondary);">No purchased books</div>'
                            }
                        </div>
                    </div>
                `;
                this.openModal(modalContent);
            }

            grantBook(userId) {
                const user = this.state.adminUsers.find(u => u.id === userId);
                const modalContent = `
                    <div class="modal">
                        <div class="modal-header">
                            <h2 class="modal-title">
                                <span class="material-symbols-rounded">menu_book</span>
                                Grant Book to ${user.name}
                            </h2>
                            <div class="modal-close" onclick="app.closeModal()">
                                <span class="material-symbols-rounded">close</span>
                            </div>
                        </div>
                        <div class="modal-body">
                            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem; max-height: 400px; overflow-y: auto;">
                                ${this.state.books.map(book => `
                                    <div style="background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border-light); border-radius: 12px; padding: 1rem; cursor: pointer;" onclick="app.grantBookToUser('${userId}', '${book.id}')">
                                        <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.5rem;">${book.title}</div>
                                        <div style="color: var(--text-secondary); font-size: 0.9rem;">by ${book.author}</div>
                                        <div style="color: var(--accent-blue); font-weight: 600; margin-top: 0.5rem;">
                                            ${book.price === 0 ? 'FREE' : '$' + book.price.toFixed(2)}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
                this.openModal(modalContent);
            }

            grantBookToUser(userId, bookId) {
                const user = this.state.adminUsers.find(u => u.id === userId);
                if (!user.purchasedBooks) user.purchasedBooks = [];
                
                if (!user.purchasedBooks.includes(bookId)) {
                    user.purchasedBooks.push(bookId);
                    this.saveAdminUsers();
                    this.loadAdminUsers();
                    this.showToast('Book granted to user', 'success');
                    this.closeModal();
                } else {
                    this.showToast('User already has this book', 'warning');
                }
            }

            blockUser(userId) {
                const user = this.state.adminUsers.find(u => u.id === userId);
                const action = user.blocked ? 'unblock' : 'block';
                
                if (confirm(`${action.charAt(0).toUpperCase() + action.slice(1)} this user?`)) {
                    user.blocked = !user.blocked;
                    this.saveAdminUsers();
                    this.loadAdminUsers();
                    this.showToast(`User ${action}ed`, 'success');
                }
            }

            deleteUser(userId) {
                if (confirm('Permanently delete this user?')) {
                    this.state.adminUsers = this.state.adminUsers.filter(u => u.id !== userId);
                    this.saveAdminUsers();
                    this.loadAdminUsers();
                    this.showToast('User deleted', 'success');
                }
            }

            loadAdminCategories() {
                const categories = [
                    { id: 'web', name: 'Web Development', count: this.state.books.filter(b => b.category === 'web').length },
                    { id: 'mobile', name: 'Mobile Development', count: this.state.books.filter(b => b.category === 'mobile').length },
                    { id: 'data', name: 'Data Science', count: this.state.books.filter(b => b.category === 'data').length },
                    { id: 'ai', name: 'AI & Machine Learning', count: this.state.books.filter(b => b.category === 'ai').length },
                    { id: 'devops', name: 'DevOps', count: this.state.books.filter(b => b.category === 'devops').length },
                    { id: 'algorithms', name: 'Algorithms', count: this.state.books.filter(b => b.category === 'algorithms').length }
                ];

                const container = document.getElementById('categoriesManagement');
                container.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem;">
                        ${categories.map(cat => `
                            <div style="background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border-light); border-radius: 12px; padding: 1.5rem; text-align: center;">
                                <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.5rem;">${cat.name}</div>
                                <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">${cat.count} books</div>
                                <div style="display: flex; gap: 0.5rem; justify-content: center;">
                                    <button class="btn btn-secondary" onclick="app.editCategory('${cat.id}')" style="padding: 6px 12px; font-size: 0.8rem;">
                                        Edit
                                    </button>
                                    <button class="btn btn-secondary" onclick="app.deleteCategory('${cat.id}')" style="padding: 6px 12px; font-size: 0.8rem;">
                                        Delete
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <button class="btn btn-primary" onclick="app.addCategory()" style="margin-top: 1.5rem;">
                        <span class="material-symbols-rounded">add</span>
                        Add New Category
                    </button>
                `;
            }

            addCategory() {
                const name = prompt('Enter category name:');
                if (name) {
                    this.showToast('Category added: ' + name, 'success');
                }
            }

            editCategory(categoryId) {
                const newName = prompt('Enter new category name:');
                if (newName) {
                    this.showToast('Category updated to: ' + newName, 'success');
                }
            }

            deleteCategory(categoryId) {
                if (confirm('Delete this category? All books in this category will be moved to "Other".')) {
                    // Move books to "algorithms" category
                    this.state.books.forEach(book => {
                        if (book.category === categoryId) {
                            book.category = 'algorithms';
                        }
                    });
                    this.saveBooks();
                    this.renderBooks();
                    this.renderAdminBooks();
                    this.loadAdminCategories();
                    this.showToast('Category deleted', 'success');
                }
            }

            loadAdminOrders() {
                const orders = [
                    { id: 'order-1', user: 'John Doe', books: 2, total: '$59.98', date: '2024-01-15' },
                    { id: 'order-2', user: 'Jane Smith', books: 1, total: '$39.99', date: '2024-01-20' },
                    { id: 'order-3', user: 'Bob Johnson', books: 3, total: '$89.97', date: '2024-01-25' }
                ];

                const container = document.getElementById('ordersList');
                container.innerHTML = `
                    <div style="background: rgba(255, 255, 255, 0.05); border-radius: 12px; overflow: hidden;">
                        ${orders.map(order => `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; border-bottom: 1px solid var(--border-light);">
                                <div>
                                    <div style="font-weight: 600; color: var(--text-primary);">Order ${order.id}</div>
                                    <div style="color: var(--text-secondary); font-size: 0.9rem;">${order.user}  ${order.date}</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-weight: 600; color: var(--text-primary);">${order.total}</div>
                                    <div style="color: var(--text-secondary); font-size: 0.9rem;">${order.books} books</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            loadRecentActivity() {
                const activities = [
                    { type: 'user', text: 'New user registered', time: '2 minutes ago' },
                    { type: 'book', text: 'Book added to library', time: '15 minutes ago' },
                    { type: 'order', text: 'Order completed: $29.99', time: '1 hour ago' },
                    { type: 'user', text: 'User profile updated', time: '2 hours ago' }
                ];

                const container = document.getElementById('recentActivity');
                container.innerHTML = activities.map(activity => `
                    <div style="display: flex; align-items: center; gap: 10px; padding: 10px 0; border-bottom: 1px solid var(--border-light);">
                        <span class="material-symbols-rounded" style="color: ${
                            activity.type === 'user' ? 'var(--accent-blue)' :
                            activity.type === 'book' ? 'var(--accent-green)' : 'var(--accent-purple)'
                        };">
                            ${activity.type === 'user' ? 'person' : activity.type === 'book' ? 'menu_book' : 'shopping_cart'}
                        </span>
                        <div style="flex: 1;">
                            <div style="color: var(--text-primary);">${activity.text}</div>
                            <div style="color: var(--text-muted); font-size: 0.85rem;">${activity.time}</div>
                        </div>
                    </div>
                `).join('');
            }

            saveAdminSettings() {
                const settings = {
                    siteName: document.getElementById('siteName').value,
                    siteDescription: document.getElementById('siteDescription').value,
                    defaultCurrency: document.getElementById('defaultCurrency').value,
                    defaultLanguage: document.getElementById('defaultLanguage').value
                };
                this.state.settings = settings;
                localStorage.setItem('bp_settings', JSON.stringify(settings));
                this.showToast('Settings saved successfully!', 'success');
            }

            resetAdminSettings() {
                if (confirm('Reset all settings to default?')) {
                    this.state.settings = {
                        siteName: 'Better Programmer',
                        siteDescription: 'Premium Programming E-Books Library',
                        defaultCurrency: 'USD',
                        defaultLanguage: 'en'
                    };
                    document.getElementById('siteName').value = this.state.settings.siteName;
                    document.getElementById('siteDescription').value = this.state.settings.siteDescription;
                    document.getElementById('defaultCurrency').value = this.state.settings.defaultCurrency;
                    document.getElementById('defaultLanguage').value = this.state.settings.defaultLanguage;
                    localStorage.setItem('bp_settings', JSON.stringify(this.state.settings));
                    this.showToast('Settings reset to default', 'success');
                }
            }

            importBooks() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const importedBooks = JSON.parse(event.target.result);
                            this.state.books.push(...importedBooks);
                            this.saveBooks();
                            this.renderBooks();
                            this.renderAdminBooks();
                            this.showToast(`${importedBooks.length} books imported successfully!`, 'success');
                        } catch (error) {
                            this.showToast('Error importing books: Invalid JSON format', 'error');
                        }
                    };
                    reader.readAsText(file);
                };
                input.click();
            }

            exportBooks() {
                const dataStr = JSON.stringify(this.state.books, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                const exportFileDefaultName = 'better-programmer-books.json';
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                this.showToast('Books exported successfully!', 'success');
            }

            showAddBookModal() {
                const modalContent = `
                    <div class="modal">
                        <div class="modal-header">
                            <h2 class="modal-title">
                                <span class="material-symbols-rounded">menu_book</span>
                                Add New Book
                            </h2>
                            <div class="modal-close" onclick="app.closeModal()">
                                <span class="material-symbols-rounded">close</span>
                            </div>
                        </div>
                        <div class="modal-body">
                            <div class="centered-form">
                                <form id="addBookForm" onsubmit="app.handleAddBook(event)">
                                    <div class="form-group">
                                        <label class="form-label">
                                            <span class="material-symbols-rounded">title</span>
                                            Book Title
                                        </label>
                                        <input type="text" class="form-input" id="bookTitle" required placeholder="Clean Code: A Handbook of Agile Software Craftsmanship">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">
                                            <span class="material-symbols-rounded">person</span>
                                            Author
                                        </label>
                                        <input type="text" class="form-input" id="bookAuthor" required placeholder="Robert C. Martin">
                                    </div>
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label class="form-label">
                                                <span class="material-symbols-rounded">attach_money</span>
                                                Price
                                            </label>
                                            <input type="number" class="form-input" id="bookPrice" required min="0" step="0.01" placeholder="29.99">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">
                                                <span class="material-symbols-rounded">category</span>
                                                Category
                                            </label>
                                            <select class="form-input" id="bookCategory" required>
                                                <option value="web">Web Development</option>
                                                <option value="mobile">Mobile Development</option>
                                                <option value="data">Data Science</option>
                                                <option value="ai">AI & Machine Learning</option>
                                                <option value="devops">DevOps</option>
                                                <option value="algorithms">Algorithms</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label class="form-label">
                                                <span class="material-symbols-rounded">school</span>
                                                Difficulty
                                            </label>
                                            <select class="form-input" id="bookDifficulty" required>
                                                <option value="beginner">Beginner</option>
                                                <option value="intermediate">Intermediate</option>
                                                <option value="advanced">Advanced</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">
                                                <span class="material-symbols-rounded">description</span>
                                                Description
                                            </label>
                                            <textarea class="form-input" id="bookDescription" rows="2" required placeholder="Learn how to write clean, maintainable code..."></textarea>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">
                                            <span class="material-symbols-rounded">image</span>
                                            Cover Image URL
                                        </label>
                                        <input type="url" class="form-input" id="bookImage" required placeholder="https://picsum.photos/400/600?random=1">
                                    </div>
                                    <div class="form-actions">
                                        <button type="button" class="btn btn-secondary" onclick="app.closeModal()">Cancel</button>
                                        <button type="submit" class="btn btn-primary">
                                            <span class="material-symbols-rounded">add</span>
                                            Add Book
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                `;
                this.openModal(modalContent);
            }

            handleAddBook(event) {
                event.preventDefault();
                const title = document.getElementById('bookTitle').value.trim();
                const author = document.getElementById('bookAuthor').value.trim();
                const price = parseFloat(document.getElementById('bookPrice').value);
                const category = document.getElementById('bookCategory').value;
                const difficulty = document.getElementById('bookDifficulty').value;
                const description = document.getElementById('bookDescription').value.trim();
                const image = document.getElementById('bookImage').value.trim();

                if (!title || !author || isNaN(price) || !category || !difficulty || !description || !image) {
                    this.showToast('Please fill in all fields', 'error');
                    return;
                }

                const newBook = {
                    id: 'book-' + Date.now(),
                    title,
                    author,
                    price,
                    category,
                    difficulty,
                    description,
                    longDescription: description,
                    image,
                    rating: 4.5,
                    reviews: Math.floor(Math.random() * 500) + 100,
                    pages: Math.floor(Math.random() * 400) + 200,
                    language: 'English',
                    published: new Date().toISOString().split('T')[0],
                    publisher: 'Better Programmer Press',
                    topics: [category.charAt(0).toUpperCase() + category.slice(1)],
                    previewContent: `Preview of ${title} by ${author}. This book covers ${description.toLowerCase()}...`,
                    badges: price === 0 ? ['free', 'new'] : (Math.random() > 0.7 ? ['popular'] : [])
                };

                this.state.books.push(newBook);
                this.saveBooks();
                this.renderBooks();
                this.renderAdminBooks();
                this.closeModal();
                this.showToast('Book added successfully', 'success');
                document.getElementById('addBookForm').reset();
            }

            renderAdminBooks() {
                const adminBooksList = document.getElementById('adminBooksList');
                if (!adminBooksList) return;

                adminBooksList.innerHTML = this.state.books.map(book => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; border-bottom: 1px solid var(--border-light);">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <img src="${book.image}" style="width: 60px; height: 80px; border-radius: 8px; object-fit: cover;" onerror="this.src='https://picsum.photos/400/600?book'">
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary);">${book.title}</div>
                                <div style="color: var(--text-secondary); font-size: 0.9rem;">by ${book.author}</div>
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.25rem;">
                                    <span class="badge ${book.price === 0 ? 'badge-free' : 'badge-popular'}" style="padding: 2px 8px; font-size: 0.7rem;">
                                        ${book.price === 0 ? 'FREE' : '$' + book.price}
                                    </span>
                                    <span style="color: var(--text-muted); font-size: 0.8rem;"></span>
                                    <span style="color: var(--text-muted); font-size: 0.8rem;">${this.getCategoryName(book.category)}</span>
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-secondary" onclick="app.editBook('${book.id}')" style="padding: 6px 12px; font-size: 0.8rem;">
                                <span class="material-symbols-rounded" style="font-size: 1rem;">edit</span>
                            </button>
                            <button class="btn btn-secondary" onclick="app.deleteBook('${book.id}')" style="padding: 6px 12px; font-size: 0.8rem; color: #ef4444;">
                                <span class="material-symbols-rounded" style="font-size: 1rem;">delete</span>
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            editBook(bookId) {
                const book = this.state.books.find(b => b.id === bookId);
                if (!book) return;

                const modalContent = `
                    <div class="modal">
                        <div class="modal-header">
                            <h2 class="modal-title">
                                <span class="material-symbols-rounded">menu_book</span>
                                Edit Book
                            </h2>
                            <div class="modal-close" onclick="app.closeModal()">
                                <span class="material-symbols-rounded">close</span>
                            </div>
                        </div>
                        <div class="modal-body">
                            <div class="centered-form">
                                <form id="editBookForm" onsubmit="app.handleEditBook('${bookId}', event)">
                                    <div class="form-group">
                                        <label class="form-label">
                                            <span class="material-symbols-rounded">title</span>
                                            Book Title
                                        </label>
                                        <input type="text" class="form-input" id="editBookTitle" required value="${book.title}">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">
                                            <span class="material-symbols-rounded">person</span>
                                            Author
                                        </label>
                                        <input type="text" class="form-input" id="editBookAuthor" required value="${book.author}">
                                    </div>
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label class="form-label">
                                                <span class="material-symbols-rounded">attach_money</span>
                                                Price
                                            </label>
                                            <input type="number" class="form-input" id="editBookPrice" required min="0" step="0.01" value="${book.price}">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">
                                                <span class="material-symbols-rounded">category</span>
                                                Category
                                            </label>
                                            <select class="form-input" id="editBookCategory" required>
                                                <option value="web" ${book.category === 'web' ? 'selected' : ''}>Web Development</option>
                                                <option value="mobile" ${book.category === 'mobile' ? 'selected' : ''}>Mobile Development</option>
                                                <option value="data" ${book.category === 'data' ? 'selected' : ''}>Data Science</option>
                                                <option value="ai" ${book.category === 'ai' ? 'selected' : ''}>AI & Machine Learning</option>
                                                <option value="devops" ${book.category === 'devops' ? 'selected' : ''}>DevOps</option>
                                                <option value="algorithms" ${book.category === 'algorithms' ? 'selected' : ''}>Algorithms</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label class="form-label">
                                                <span class="material-symbols-rounded">school</span>
                                                Difficulty
                                            </label>
                                            <select class="form-input" id="editBookDifficulty" required>
                                                <option value="beginner" ${book.difficulty === 'beginner' ? 'selected' : ''}>Beginner</option>
                                                <option value="intermediate" ${book.difficulty === 'intermediate' ? 'selected' : ''}>Intermediate</option>
                                                <option value="advanced" ${book.difficulty === 'advanced' ? 'selected' : ''}>Advanced</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">
                                                <span class="material-symbols-rounded">description</span>
                                                Description
                                            </label>
                                            <textarea class="form-input" id="editBookDescription" rows="2" required>${book.description}</textarea>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">
                                            <span class="material-symbols-rounded">image</span>
                                            Cover Image URL
                                        </label>
                                        <input type="url" class="form-input" id="editBookImage" required value="${book.image}">
                                    </div>
                                    <div class="form-actions">
                                        <button type="button" class="btn btn-secondary" onclick="app.closeModal()">Cancel</button>
                                        <button type="submit" class="btn btn-primary">
                                            <span class="material-symbols-rounded">save</span>
                                            Update Book
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                `;
                this.openModal(modalContent);
            }

            handleEditBook(bookId, event) {
                event.preventDefault();
                const title = document.getElementById('editBookTitle').value.trim();
                const author = document.getElementById('editBookAuthor').value.trim();
                const price = parseFloat(document.getElementById('editBookPrice').value);
                const category = document.getElementById('editBookCategory').value;
                const difficulty = document.getElementById('editBookDifficulty').value;
                const description = document.getElementById('editBookDescription').value.trim();
                const image = document.getElementById('editBookImage').value.trim();

                const bookIndex = this.state.books.findIndex(b => b.id === bookId);
                if (bookIndex !== -1) {
                    this.state.books[bookIndex] = {
                        ...this.state.books[bookIndex],
                        title,
                        author,
                        price,
                        category,
                        difficulty,
                        description,
                        image
                    };
                    this.saveBooks();
                    this.renderBooks();
                    this.renderAdminBooks();
                    this.closeModal();
                    this.showToast('Book updated successfully', 'success');
                }
            }

            deleteBook(bookId) {
                if (confirm('Are you sure you want to delete this book?')) {
                    const bookIndex = this.state.books.findIndex(b => b.id === bookId);
                    if (bookIndex !== -1) {
                        const bookTitle = this.state.books[bookIndex].title;
                        this.state.books.splice(bookIndex, 1);
                        this.saveBooks();
                        this.renderBooks();
                        this.renderAdminBooks();
                        this.showToast(`"${bookTitle}" deleted successfully`, 'success');
                    }
                }
            }

            navigateTo(page) {
                // Update active nav link
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                    if (link.dataset.page === page) {
                        link.classList.add('active');
                    }
                });

                // Hide all pages and show the selected one
                document.querySelectorAll('.page').forEach(pageElement => {
                    pageElement.classList.remove('active');
                });

                const targetPage = document.getElementById(page + 'Page');
                if (targetPage) {
                    targetPage.classList.add('active');
                    document.getElementById('mainContent').scrollIntoView({
                        behavior: 'smooth'
                    });
                }

                // Special handling for certain pages
                if (page === 'books') {
                    this.filterAndRenderBooks();
                } else if (page === 'profile') {
                    this.renderProfile();
                } else if (page === 'adminPanel') {
                    this.loadAdminData();
                }
            }

            renderBooks() {
                const booksGrid = document.getElementById('booksGrid');
                if (!booksGrid) return;

                const books = this.getFilteredBooks();
                if (books.length === 0) {
                    booksGrid.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 4rem; color: var(--text-secondary);">
                            <span class="material-symbols-rounded" style="font-size: 4rem; margin-bottom: 1rem; color: var(--accent-blue);">search_off</span>
                            <h3 style="color: var(--text-primary); margin-bottom: 0.5rem;">No books found</h3>
                            <p>Try adjusting your filters or search terms</p>
                        </div>
                    `;
                    return;
                }

                booksGrid.innerHTML = books.map(book => `
                    <div class="book-card" data-id="${book.id}">
                        <div class="book-cover">
                            <img src="${book.image}" alt="${book.title}" class="book-image" onerror="this.src='https://picsum.photos/400/600?book'">
                            <div class="book-badges">
                                ${book.price === 0 ? '<div class="badge badge-free">FREE</div>' : ''}
                                ${book.badges && book.badges.includes('new') ? '<div class="badge badge-new">NEW</div>' : ''}
                                ${book.badges && (book.badges.includes('popular') || book.badges.includes('bestseller')) ? '<div class="badge badge-popular">POPULAR</div>' : ''}
                            </div>
                        </div>
                        <div class="book-info">
                            <h3 class="book-title">${book.title}</h3>
                            <div class="book-author">
                                <span class="material-symbols-rounded" style="font-size: 1rem;">person</span>
                                ${book.author}
                            </div>
                            <p class="book-description">${book.description}</p>
                            <div class="book-meta">
                                <span class="book-category">${this.getCategoryName(book.category)}</span>
                                <div class="book-rating">
                                    <span>${book.rating ? book.rating.toFixed(1) : '4.5'}</span>
                                    <span class="material-symbols-rounded" style="color: var(--accent-orange);">star</span>
                                    <span style="color: var(--text-muted); font-size: 0.8rem;">(${book.reviews || '100'})</span>
                                </div>
                            </div>
                            <div class="book-price-section">
                                <div>
                                    <div class="book-price ${book.price === 0 ? 'book-price-free' : ''}">
                                        ${book.price === 0 ? 'FREE' : '$' + book.price.toFixed(2)}
                                    </div>
                                    ${book.originalPrice ? `
                                        <div style="color: var(--text-muted); text-decoration: line-through; font-size: 0.9rem;">$${book.originalPrice.toFixed(2)}</div>
                                    ` : ''}
                                </div>
                                <div style="color: var(--text-muted); font-size: 0.85rem;">
                                    ${book.pages || '300'} pages
                                </div>
                            </div>
                            <div class="book-actions">
                                <button class="btn btn-primary btn-small" onclick="app.buyBook('${book.id}')">
                                    <span class="material-symbols-rounded">shopping_cart</span>
                                    Buy Now
                                </button>
                                <button class="btn btn-cart btn-small" onclick="app.addToCart('${book.id}')">
                                    <span class="material-symbols-rounded">add_shopping_cart</span>
                                    Add to Cart
                                </button>
                                <button class="btn btn-secondary btn-fullwidth btn-small" onclick="app.showBookPreview('${book.id}')">
                                    <span class="material-symbols-rounded">visibility</span>
                                    Preview Book
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            getFilteredBooks() {
                let filtered = [...this.state.books];

                if (this.state.filters.category !== 'all') {
                    filtered = filtered.filter(book => book.category === this.state.filters.category);
                }

                switch (this.state.filters.price) {
                    case 'free':
                        filtered = filtered.filter(book => book.price === 0);
                        break;
                    case 'paid':
                        filtered = filtered.filter(book => book.price > 0);
                        break;
                    case 'under-20':
                        filtered = filtered.filter(book => book.price < 20);
                        break;
                    case '20-50':
                        filtered = filtered.filter(book => book.price >= 20 && book.price <= 50);
                        break;
                    case 'over-50':
                        filtered = filtered.filter(book => book.price > 50);
                        break;
                }

                if (this.state.filters.difficulty !== 'all') {
                    filtered = filtered.filter(book => book.difficulty === this.state.filters.difficulty);
                }

                if (this.state.filters.search.trim()) {
                    const searchTerm = this.state.filters.search.toLowerCase();
                    filtered = filtered.filter(book =>
                        book.title.toLowerCase().includes(searchTerm) ||
                        book.author.toLowerCase().includes(searchTerm) ||
                        book.description.toLowerCase().includes(searchTerm)
                    );
                }

                filtered.sort((a, b) => {
                    switch (this.state.filters.sort) {
                        case 'newest':
                            return new Date(b.published || '2000-01-01') - new Date(a.published || '2000-01-01');
                        case 'rating':
                            return (b.rating || 0) - (a.rating || 0);
                        case 'price-low':
                            return a.price - b.price;
                        case 'price-high':
                            return b.price - a.price;
                        case 'popular':
                        default:
                            return (b.reviews || 0) - (a.reviews || 0);
                    }
                });

                return filtered;
            }

            filterAndRenderBooks() {
                this.renderBooks();
            }

            resetFilters() {
                this.state.filters = {
                    category: 'all',
                    price: 'all',
                    sort: 'popular',
                    difficulty: 'all',
                    search: ''
                };
                document.getElementById('categoryFilter').value = 'all';
                document.getElementById('priceFilter').value = 'all';
                document.getElementById('sortFilter').value = 'popular';
                document.getElementById('difficultyFilter').value = 'all';
                document.getElementById('searchInput').value = '';
                this.renderBooks();
                this.showToast('Filters reset', 'success');
            }

            setFilter(filter, value) {
                this.state.filters[filter] = value;
                this.filterAndRenderBooks();
            }

            loadMoreBooks() {
                this.showToast('Loading more books...', 'info');
                setTimeout(() => {
                    this.showToast('No more books to load', 'info');
                }, 1000);
            }

            buyBook(bookId) {
                const book = this.state.books.find(b => b.id === bookId);
                if (!book) return;

                if (book.price === 0) {
                    this.addToCart(bookId);
                    this.showToast('Book added to your library for free!', 'success');
                    return;
                }

                if (!this.state.user) {
                    this.showAuthModal();
                    return;
                }

                this.state.currentBookId = bookId;
                this.showPurchaseModal(book);
            }

            showPurchaseModal(book) {
                const modalContent = `
                    <div class="modal">
                        <div class="modal-header">
                            <h2 class="modal-title">
                                <span class="material-symbols-rounded">shopping_cart</span>
                                Complete Purchase
                            </h2>
                            <div class="modal-close" onclick="app.closeModal()">
                                <span class="material-symbols-rounded">close</span>
                            </div>
                        </div>
                        <div class="modal-body">
                            <div class="centered-form">
                                <div style="text-align: center; margin-bottom: 2rem;">
                                    <img src="${book.image}" alt="${book.title}" style="width: 150px; border-radius: 12px; box-shadow: var(--shadow-lg); margin-bottom: 1rem;" onerror="this.src='https://picsum.photos/400/600?book'">
                                    <h3 style="color: var(--text-primary); margin-bottom: 0.5rem;">${book.title}</h3>
                                    <p style="color: var(--text-secondary);">by ${book.author}</p>
                                    <div style="font-size: 2rem; color: var(--accent-blue); font-weight: 700; margin: 1rem 0;">
                                        ${book.price === 0 ? 'FREE' : '$' + book.price.toFixed(2)}
                                    </div>
                                </div>
                                <form id="purchaseForm" onsubmit="app.handlePurchase(event)">
                                    ${book.price > 0 ? `
                                        <div class="form-group">
                                            <label class="form-label">
                                                <span class="material-symbols-rounded">credit_card</span>
                                                Payment Method
                                            </label>
                                            <div class="payment-methods">
                                                <div class="payment-method active" data-method="card">
                                                    <span class="material-symbols-rounded">credit_card</span>
                                                    <div>Card</div>
                                                </div>
                                                <div class="payment-method" data-method="paypal">
                                                    <span class="material-symbols-rounded">payments</span>
                                                    <div>PayPal</div>
                                                </div>
                                                <div class="payment-method" data-method="bank">
                                                    <span class="material-symbols-rounded">account_balance</span>
                                                    <div>Bank</div>
                                                </div>
                                            </div>
                                            <div class="card-details active" id="cardDetails">
                                                <div class="form-grid">
                                                    <div class="form-group">
                                                        <input type="text" class="form-input" placeholder="Card Number" required>
                                                    </div>
                                                    <div class="form-group">
                                                        <input type="text" class="form-input" placeholder="MM/YY" required>
                                                    </div>
                                                    <div class="form-group">
                                                        <input type="text" class="form-input" placeholder="CVC" required>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    ` : ''}
                                    <div class="form-actions">
                                        <button type="button" class="btn btn-secondary" onclick="app.closeModal()">Cancel</button>
                                        <button type="submit" class="btn btn-primary">
                                            <span class="material-symbols-rounded">lock</span>
                                            Complete Purchase
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                `;

                this.openModal(modalContent);

                // Payment method selection
                document.querySelectorAll('.payment-method').forEach(method => {
                    method.addEventListener('click', () => {
                        document.querySelectorAll('.payment-method').forEach(m => {
                            m.classList.remove('active');
                        });
                        method.classList.add('active');
                        
                        document.querySelectorAll('.card-details').forEach(detail => {
                            detail.classList.remove('active');
                        });
                        
                        const methodType = method.dataset.method;
                        if (methodType === 'card') {
                            document.getElementById('cardDetails')?.classList.add('active');
                        }
                    });
                });
            }

            handlePurchase(event) {
                event.preventDefault();
                const book = this.state.books.find(b => b.id === this.state.currentBookId);
                if (!book) return;

                if (book.price > 0) {
                    const selectedMethod = document.querySelector('.payment-method.active')?.dataset.method;
                    if (!selectedMethod) {
                        this.showToast('Please select a payment method', 'error');
                        return;
                    }
                }

                // Add book to user's purchased books
                if (!this.state.user.purchasedBooks) {
                    this.state.user.purchasedBooks = [];
                }
                this.state.user.purchasedBooks.push(book.id);
                this.saveUser();

                // Add to admin users if not already there
                const existingAdminUser = this.state.adminUsers.find(u => u.email === this.state.user.email);
                if (existingAdminUser) {
                    if (!existingAdminUser.purchasedBooks) {
                        existingAdminUser.purchasedBooks = [];
                    }
                    existingAdminUser.purchasedBooks.push(book.id);
                    this.saveAdminUsers();
                }

                this.showToast(`Successfully purchased "${book.title}"!`, 'success');
                this.closeModal();
                this.renderProfile();
            }

            showBookPreview(bookId) {
                const book = this.state.books.find(b => b.id === bookId);
                if (!book) return;

                const content = `
                    <div class="modal">
                        <div class="modal-header">
                            <h2 class="modal-title">
                                <span class="material-symbols-rounded">preview</span>
                                Book Preview
                            </h2>
                            <div class="modal-close" onclick="app.closeModal()">
                                <span class="material-symbols-rounded">close</span>
                            </div>
                        </div>
                        <div class="modal-body">
                            <div style="text-align: center; margin-bottom: 2rem;">
                                <img src="${book.image}" alt="${book.title}" style="width: 200px; border-radius: 12px; box-shadow: var(--shadow-lg); margin-bottom: 1rem;" onerror="this.src='https://picsum.photos/400/600?book'">
                                <h3 style="color: var(--text-primary); margin-bottom: 0.5rem;">${book.title}</h3>
                                <p style="color: var(--text-secondary);">Preview Chapter 1</p>
                            </div>
                            <div style="background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border-light); border-radius: 12px; padding: 2rem; max-height: 400px; overflow-y: auto;">
                                <div style="color: var(--text-secondary); line-height: 1.8; font-size: 0.95rem;">
                                    ${book.previewContent || 'No preview available for this book.'}
                                </div>
                            </div>
                            <div style="display: flex; gap: 1rem; margin-top: 2rem; justify-content: center;">
                                <button class="btn btn-primary" onclick="app.buyBook('${book.id}'); app.closeModal();">
                                    <span class="material-symbols-rounded">shopping_cart</span>
                                    Buy Full Book
                                </button>
                                <button class="btn btn-cart" onclick="app.addToCart('${book.id}'); app.closeModal();">
                                    <span class="material-symbols-rounded">add_shopping_cart</span>
                                    Add to Cart
                                </button>
                                <button class="btn btn-secondary" onclick="app.closeModal();">
                                    <span class="material-symbols-rounded">close</span>
                                    Close Preview
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                this.openModal(content);
            }

            addToCart(bookId) {
                const book = this.state.books.find(b => b.id === bookId);
                if (!book) return;

                const existingItem = this.state.cart.find(item => item.id === bookId);
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    this.state.cart.push({
                        id: bookId,
                        title: book.title,
                        price: book.price,
                        image: book.image,
                        quantity: 1
                    });
                }

                this.saveCart();
                this.updateCartCount();
                this.showToast(`Added "${book.title}" to cart`, 'success');
            }

            removeFromCart(bookId) {
                const index = this.state.cart.findIndex(item => item.id === bookId);
                if (index !== -1) {
                    this.state.cart.splice(index, 1);
                    this.saveCart();
                    this.updateCartCount();
                    this.renderCart();
                    this.showToast('Item removed from cart', 'success');
                }
            }

            showCart() {
                this.renderCart();
            }

            renderCart() {
                const modalContent = `
                    <div class="modal">
                        <div class="modal-header">
                            <h2 class="modal-title">
                                <span class="material-symbols-rounded">shopping_cart</span>
                                Your Cart
                            </h2>
                            <div class="modal-close" onclick="app.closeModal()">
                                <span class="material-symbols-rounded">close</span>
                            </div>
                        </div>
                        <div class="modal-body">
                            ${this.state.cart.length === 0 ? `
                                <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                                    <span class="material-symbols-rounded" style="font-size: 4rem; margin-bottom: 1rem; color: var(--accent-blue);">shopping_cart</span>
                                    <h3 style="color: var(--text-primary); margin-bottom: 0.5rem;">Your cart is empty</h3>
                                    <p>Add some books to get started!</p>
                                    <button class="btn btn-primary" onclick="app.navigateTo('books'); app.closeModal();" style="margin-top: 1rem;">
                                        <span class="material-symbols-rounded">explore</span>
                                        Browse Books
                                    </button>
                                </div>
                            ` : `
                                <div>
                                    ${this.state.cart.map(item => {
                                        const book = this.state.books.find(b => b.id === item.id);
                                        return `
                                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; border-bottom: 1px solid var(--border-light);">
                                                <div style="display: flex; align-items: center; gap: 1rem;">
                                                    <img src="${item.image}" style="width: 60px; height: 80px; border-radius: 8px; object-fit: cover;" onerror="this.src='https://picsum.photos/400/600?book'">
                                                    <div>
                                                        <div style="font-weight: 600; color: var(--text-primary);">${item.title}</div>
                                                        <div style="color: var(--text-secondary); font-size: 0.9rem;">${item.price === 0 ? 'FREE' : '$' + item.price.toFixed(2)}</div>
                                                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.25rem;">
                                                            <button class="btn btn-secondary" onclick="app.removeFromCart('${item.id}')" style="padding: 4px 8px; font-size: 0.8rem;">
                                                                <span class="material-symbols-rounded">delete</span>
                                                                Remove
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div style="color: var(--text-primary); font-weight: 600;">
                                                    ${item.price === 0 ? 'FREE' : '$' + (item.price * item.quantity).toFixed(2)}
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                                <div style="border-top: 1px solid var(--border-light); padding-top: 1.5rem; margin-top: 1.5rem; text-align: right;">
                                    <div style="display: flex; justify-content: space-between; font-size: 1.25rem;">
                                        <div style="color: var(--text-primary); font-weight: 600;">Total</div>
                                        <div style="color: var(--accent-blue); font-weight: 700;">$${this.state.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0).toFixed(2)}</div>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 1rem; margin-top: 2rem; justify-content: flex-end;">
                                    <button class="btn btn-secondary" onclick="app.closeModal()">Continue Browsing</button>
                                    <button class="btn btn-primary" onclick="app.checkout()">Checkout</button>
                                </div>
                            `}
                        </div>
                    </div>
                `;
                this.openModal(modalContent);
            }

            checkout() {
                if (this.state.cart.length === 0) {
                    this.showToast('Your cart is empty', 'warning');
                    return;
                }

                if (!this.state.user) {
                    this.showToast('Please sign in to checkout', 'warning');
                    this.showAuthModal();
                    return;
                }

                const total = this.state.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                if (total > 0) {
                    this.showPurchaseModalForCart();
                } else {
                    this.completePurchase();
                }
            }

            showPurchaseModalForCart() {
                const modalContent = `
                    <div class="modal">
                        <div class="modal-header">
                            <h2 class="modal-title">
                                <span class="material-symbols-rounded">shopping_cart</span>
                                Complete Purchase
                            </h2>
                            <div class="modal-close" onclick="app.closeModal()">
                                <span class="material-symbols-rounded">close</span>
                            </div>
                        </div>
                        <div class="modal-body">
                            <div class="centered-form">
                                <h3 style="text-align: center; margin-bottom: 1.5rem; color: var(--text-primary);">Order Summary</h3>
                                <div style="background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem;">
                                    ${this.state.cart.map(item => `
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                            <div style="color: var(--text-secondary);">${item.title}</div>
                                            <div style="color: var(--text-primary); font-weight: 500;">${item.price === 0 ? 'FREE' : '$' + (item.price * item.quantity).toFixed(2)}</div>
                                        </div>
                                    `).join('')}
                                    <div style="border-top: 1px solid var(--border-light); margin-top: 1rem; padding-top: 1rem;">
                                        <div style="display: flex; justify-content: space-between; font-size: 1.25rem;">
                                            <div style="color: var(--text-primary); font-weight: 600;">Total</div>
                                            <div style="color: var(--accent-blue); font-weight: 700;">$${this.state.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0).toFixed(2)}</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">
                                        <span class="material-symbols-rounded">credit_card</span>
                                        Payment Method
                                    </label>
                                    <div class="payment-methods">
                                        <div class="payment-method active" data-method="card">
                                            <span class="material-symbols-rounded">credit_card</span>
                                            <div>Card</div>
                                        </div>
                                        <div class="payment-method" data-method="paypal">
                                            <span class="material-symbols-rounded">payments</span>
                                            <div>PayPal</div>
                                        </div>
                                        <div class="payment-method" data-method="bank">
                                            <span class="material-symbols-rounded">account_balance</span>
                                            <div>Bank</div>
                                        </div>
                                    </div>
                                    <div class="card-details active" id="cartCardDetails">
                                        <div class="form-grid">
                                            <div class="form-group">
                                                <input type="text" class="form-input" placeholder="Card Number" required>
                                            </div>
                                            <div class="form-group">
                                                <input type="text" class="form-input" placeholder="MM/YY" required>
                                            </div>
                                            <div class="form-group">
                                                <input type="text" class="form-input" placeholder="CVC" required>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button type="button" class="btn btn-secondary" onclick="app.closeModal()">Cancel</button>
                                    <button type="button" class="btn btn-primary" onclick="app.completePurchase()">
                                        <span class="material-symbols-rounded">lock</span>
                                        Complete Purchase
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                this.openModal(modalContent);

                // Payment method selection
                document.querySelectorAll('.payment-method').forEach(method => {
                    method.addEventListener('click', () => {
                        document.querySelectorAll('.payment-method').forEach(m => {
                            m.classList.remove('active');
                        });
                        method.classList.add('active');
                        
                        document.querySelectorAll('.card-details').forEach(detail => {
                            detail.classList.remove('active');
                        });
                        
                        const methodType = method.dataset.method;
                        if (methodType === 'card') {
                            document.getElementById('cartCardDetails')?.classList.add('active');
                        }
                    });
                });
            }

            completePurchase() {
                // Add all cart books to user's purchased books
                this.state.cart.forEach(item => {
                    if (!this.state.user.purchasedBooks) {
                        this.state.user.purchasedBooks = [];
                    }
                    this.state.user.purchasedBooks.push(item.id);

                    // Add to admin users
                    const existingAdminUser = this.state.adminUsers.find(u => u.email === this.state.user.email);
                    if (existingAdminUser) {
                        if (!existingAdminUser.purchasedBooks) {
                            existingAdminUser.purchasedBooks = [];
                        }
                        existingAdminUser.purchasedBooks.push(item.id);
                    }
                });

                this.saveUser();
                this.saveAdminUsers();

                this.state.cart = [];
                this.saveCart();
                this.updateCartCount();
                this.closeModal();
                this.showToast('Purchase completed successfully!', 'success');
                this.navigateTo('profile');
            }

            updateCartCount() {
                const cartCount = document.getElementById('cartCount');
                if (!cartCount) return;
                const count = this.state.cart.reduce((sum, item) => sum + item.quantity, 0);
                cartCount.textContent = count;
            }

            showAuthModal() {
                const modalContent = `
                    <div class="modal">
                        <div class="modal-header">
                            <h2 class="modal-title">
                                <span class="material-symbols-rounded">login</span>
                                Welcome Back
                            </h2>
                            <div class="modal-close" onclick="app.closeModal()">
                                <span class="material-symbols-rounded">close</span>
                            </div>
                        </div>
                        <div class="modal-body">
                            <div class="centered-form">
                                <form id="authForm" onsubmit="app.handleLogin(event)">
                                    <div class="form-group">
                                        <label class="form-label">
                                            <span class="material-symbols-rounded">email</span>
                                            Username/Email
                                        </label>
                                        <input type="text" class="form-input" id="authEmail" required placeholder="better or you@example.com">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">
                                            <span class="material-symbols-rounded">key</span>
                                            Password
                                        </label>
                                        <input type="password" class="form-input" id="authPassword" required placeholder="">
                                    </div>
                                    <div class="form-actions">
                                        <button type="submit" class="btn btn-primary">
                                            <span class="material-symbols-rounded">login</span>
                                            Sign In
                                        </button>
                                        <button type="button" class="btn btn-secondary" onclick="app.showSignupModal()">
                                            Create Account
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                `;
                this.openModal(modalContent);
            }

            showSignupModal() {
                const modalContent = `
                    <div class="modal">
                        <div class="modal-header">
                            <h2 class="modal-title">
                                <span class="material-symbols-rounded">person_add</span>
                                Create Account
                            </h2>
                            <div class="modal-close" onclick="app.closeModal()">
                                <span class="material-symbols-rounded">close</span>
                            </div>
                        </div>
                        <div class="modal-body">
                            <div class="centered-form">
                                <form id="signupForm" onsubmit="app.handleSignup(event)">
                                    <div class="form-group">
                                        <label class="form-label">
                                            <span class="material-symbols-rounded">person</span>
                                            Full Name
                                        </label>
                                        <input type="text" class="form-input" id="signupName" required placeholder="John Doe">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">
                                            <span class="material-symbols-rounded">email</span>
                                            Email Address
                                        </label>
                                        <input type="email" class="form-input" id="signupEmail" required placeholder="you@example.com">
                                        <small style="color: var(--text-muted); display: block; margin-top: 0.25rem;">Use your real email for registration</small>
                                    </div>
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label class="form-label">
                                                <span class="material-symbols-rounded">phone</span>
                                                Phone Number
                                            </label>
                                            <input type="tel" class="form-input" id="signupPhone" required placeholder="+995 123 456 789">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">
                                                <span class="material-symbols-rounded">cake</span>
                                                Age
                                            </label>
                                            <input type="number" class="form-input" id="signupAge" required min="13" max="120" placeholder="25">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">
                                            <span class="material-symbols-rounded">photo_camera</span>
                                            Profile Picture (Optional)
                                        </label>
                                        <input type="file" class="form-input" id="signupAvatar" accept="image/*">
                                        <small style="color: var(--text-muted); display: block; margin-top: 0.25rem;">
                                            Max size: 5MB, Formats: JPG, PNG, GIF
                                        </small>
                                        <div id="avatarPreview" style="width: 100px; height: 100px; border-radius: 50%; background: var(--gradient-primary); margin-top: 10px; display: none; overflow: hidden;">
                                            <img id="avatarPreviewImg" style="width: 100%; height: 100%; object-fit: cover;">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">
                                            <span class="material-symbols-rounded">key</span>
                                            Password
                                        </label>
                                        <input type="password" class="form-input" id="signupPassword" required placeholder="">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">
                                            <span class="material-symbols-rounded">key</span>
                                            Confirm Password
                                        </label>
                                        <input type="password" class="form-input" id="signupConfirmPassword" required placeholder="">
                                    </div>
                                    <div class="form-actions">
                                        <button type="submit" class="btn btn-primary">
                                            <span class="material-symbols-rounded">person_add</span>
                                            Create Account
                                        </button>
                                        <button type="button" class="btn btn-secondary" onclick="app.showAuthModal()">
                                            Already have account?
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                `;

                this.openModal(modalContent);

                // Avatar preview
                const avatarInput = document.getElementById('signupAvatar');
                const avatarPreview = document.getElementById('avatarPreview');
                const avatarPreviewImg = document.getElementById('avatarPreviewImg');

                avatarInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        if (file.size > 5 * 1024 * 1024) {
                            alert('File size must be less than 5MB');
                            return;
                        }

                        const reader = new FileReader();
                        reader.onload = function(e) {
                            avatarPreview.style.display = 'block';
                            avatarPreviewImg.src = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }

            handleLogin(event) {
                event.preventDefault();
                const email = document.getElementById('authEmail').value.trim();
                const password = document.getElementById('authPassword').value.trim();

                if (!email || !password) {
                    this.showToast('Please fill in all fields', 'error');
                    return;
                }

                // Special admin login
                if (email === 'better' && password === 'tweekex15') {
                    this.state.user = {
                        id: 'admin-' + Date.now(),
                        email: 'better',
                        name: 'Admin User',
                        role: 'admin',
                        phone: '+995 123 456 789',
                        age: 30,
                        purchasedBooks: []
                    };
                    this.saveUser();
                    this.closeModal();
                    this.updateUI();
                    this.showToast('Welcome back, Admin!', 'success');
                    return;
                }

                // Check if user is registered
                if (!this.state.registeredUsers.has(email)) {
                    this.showToast('This email is not registered. Please sign up first.', 'error');
                    return;
                }

                // Check if user is blocked
                const adminUser = this.state.adminUsers.find(u => u.email === email);
                if (adminUser?.blocked) {
                    this.showToast('This account has been blocked. Contact support.', 'error');
                    return;
                }

                // Regular user login
                this.state.user = {
                    id: 'user-' + Date.now(),
                    email,
                    name: adminUser?.name || email.split('@')[0],
                    role: 'user',
                    phone: adminUser?.phone || '+995 123 456 789',
                    age: adminUser?.age || 25,
                    purchasedBooks: adminUser?.purchasedBooks || []
                };

                this.saveUser();
                this.closeModal();
                this.updateUI();
                this.showToast('Welcome back!', 'success');
            }

            handleSignup(event) {
                event.preventDefault();
                const name = document.getElementById('signupName').value.trim();
                const email = document.getElementById('signupEmail').value.trim();
                const phone = document.getElementById('signupPhone').value.trim();
                const age = document.getElementById('signupAge').value.trim();
                const password = document.getElementById('signupPassword').value.trim();
                const confirmPassword = document.getElementById('signupConfirmPassword').value.trim();
                const avatarFile = document.getElementById('signupAvatar').files[0];

                if (!name || !email || !phone || !age || !password || !confirmPassword) {
                    this.showToast('Please fill in all required fields', 'error');
                    return;
                }

                if (password !== confirmPassword) {
                    this.showToast('Passwords do not match', 'error');
                    return;
                }

                if (age < 13 || age > 120) {
                    this.showToast('Age must be between 13 and 120', 'error');
                    return;
                }

                // Check if email already registered
                if (this.state.registeredUsers.has(email)) {
                    this.showToast('This email is already registered. Please sign in instead.', 'error');
                    return;
                }

                // Handle avatar upload
                if (avatarFile) {
                    if (avatarFile.size > 5 * 1024 * 1024) {
                        this.showToast('Profile picture must be less than 5MB', 'error');
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.completeSignup(name, email, phone, age, e.target.result);
                    };
                    reader.readAsDataURL(avatarFile);
                } else {
                    this.completeSignup(name, email, phone, age, null);
                }
            }

            completeSignup(name, email, phone, age, avatarDataUrl) {
                // Add to registered users
                this.state.registeredUsers.add(email);
                this.saveRegisteredUsers();

                // Create user
                this.state.user = {
                    id: 'user-' + Date.now(),
                    email,
                    name,
                    role: 'user',
                    phone,
                    age: parseInt(age),
                    purchasedBooks: []
                };

                // Save avatar if provided
                if (avatarDataUrl) {
                    this.state.userProfileImage = avatarDataUrl;
                    localStorage.setItem('bp_user_profile_image', avatarDataUrl);
                }

                // Add to admin users
                this.state.adminUsers.push({
                    id: this.state.user.id,
                    email,
                    name,
                    role: 'user',
                    phone,
                    age: parseInt(age),
                    purchasedBooks: [],
                    blocked: false
                });
                this.saveAdminUsers();

                this.saveUser();
                this.closeModal();
                this.updateUI();
                this.showToast('Account created successfully!', 'success');
            }

            logout() {
                this.state.user = null;
                localStorage.removeItem('bp_user');
                this.updateUI();
                this.showToast('Logged out successfully', 'success');
                this.navigateTo('home');
            }

            updateUI() {
                this.updateAuthButton();
                this.updateAdminNav();
                this.renderProfile();
                this.updateProfileImage();
            }

            updateAuthButton() {
                const authBtn = document.getElementById('authBtn');
                if (!authBtn) return;
                authBtn.textContent = this.state.user ? 'Sign Out' : 'Sign In';
            }

            updateAdminNav() {
                const adminNavLink = document.getElementById('adminNavLink');
                if (!adminNavLink) return;
                adminNavLink.style.display = (this.state.user && this.state.user.role === 'admin') ? 'flex' : 'none';
            }

            renderCategories() {
                const categoriesGrid = document.getElementById('categoriesGrid');
                if (!categoriesGrid) return;

                const categories = [
                    { id: 'web', name: 'Web Development', icon: 'code', count: this.state.books.filter(b => b.category === 'web').length, description: 'Frontend, backend, full-stack development' },
                    { id: 'mobile', name: 'Mobile Development', icon: 'smartphone', count: this.state.books.filter(b => b.category === 'mobile').length, description: 'iOS, Android, React Native, Flutter' },
                    { id: 'data', name: 'Data Science', icon: 'analytics', count: this.state.books.filter(b => b.category === 'data').length, description: 'Python, R, SQL, machine learning basics' },
                    { id: 'ai', name: 'AI & Machine Learning', icon: 'psychology', count: this.state.books.filter(b => b.category === 'ai').length, description: 'Deep learning, neural networks, AI models' },
                    { id: 'devops', name: 'DevOps', icon: 'deployed_code', count: this.state.books.filter(b => b.category === 'devops').length, description: 'Docker, Kubernetes, CI/CD, cloud' },
                    { id: 'algorithms', name: 'Algorithms', icon: 'terminal', count: this.state.books.filter(b => b.category === 'algorithms').length, description: 'Data structures, algorithms, competitive programming' }
                ];

                categoriesGrid.innerHTML = categories.map(cat => `
                    <div class="category-card" onclick="app.navigateTo('books'); app.setFilter('category', '${cat.id}')">
                        <div class="category-icon">
                            <span class="material-symbols-rounded">${cat.icon}</span>
                        </div>
                        <h3 style="color: var(--text-primary); margin-bottom: 0.5rem;">${cat.name}</h3>
                        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">${cat.description}</p>
                        <div style="color: var(--accent-blue); font-weight: 600;">
                            ${cat.count} Books
                        </div>
                    </div>
                `).join('');
            }

            renderFAQ() {
                const faqContainer = document.getElementById('faqContainer');
                if (!faqContainer) return;

                const faqs = [
                    { question: 'How do I purchase a book?', answer: 'Browse our collection, click "Buy Now" on any book, and complete the checkout process. For free books, click "Get Free" to add them to your library instantly.' },
                    { question: 'Can I read books on multiple devices?', answer: 'Yes! Once purchased, you can access your books from any device with an internet connection. Your reading progress syncs automatically.' },
                    { question: 'What payment methods are accepted?', answer: 'We accept all major credit cards (Visa, MasterCard, American Express), PayPal, and bank transfers in select regions.' }
                ];

                faqContainer.innerHTML = faqs.map((faq, index) => `
                    <div class="faq-item" id="faq-${index}">
                        <div class="faq-question" onclick="app.toggleFAQ(${index})">
                            <span>${faq.question}</span>
                            <span class="material-symbols-rounded">expand_more</span>
                        </div>
                        <div class="faq-answer">
                            ${faq.answer}
                        </div>
                    </div>
                `).join('');
            }

            toggleFAQ(index) {
                const faqItem = document.getElementById(`faq-${index}`);
                if (!faqItem) return;
                const isActive = faqItem.classList.contains('active');
                document.querySelectorAll('.faq-item').forEach(item => {
                    item.classList.remove('active');
                });
                if (!isActive) {
                    faqItem.classList.add('active');
                }
            }

            renderProfile() {
                const profileInfo = document.getElementById('profileInfo');
                if (!profileInfo) return;

                if (!this.state.user) {
                    profileInfo.innerHTML = `
                        <div style="text-align: center; padding: 2rem;">
                            <span class="material-symbols-rounded" style="font-size: 4rem; color: var(--text-secondary); margin-bottom: 1rem;">person_off</span>
                            <h3 style="color: var(--text-primary); margin-bottom: 0.5rem;">Not Signed In</h3>
                            <p style="color: var(--text-secondary);">Sign in to view your profile and access purchased books.</p>
                            <button class="btn btn-primary" onclick="app.showAuthModal()" style="margin-top: 1rem;">
                                <span class="material-symbols-rounded">login</span>
                                Sign In
                            </button>
                        </div>
                    `;
                    return;
                }

                profileInfo.innerHTML = `
                    <div class="info-row">
                        <span>Name</span>
                        <span style="color: var(--text-primary); font-weight: 500;">${this.state.user.name}</span>
                    </div>
                    <div class="info-row">
                        <span>Email</span>
                        <span style="color: var(--text-primary); font-weight: 500;">${this.state.user.email}</span>
                    </div>
                    <div class="info-row">
                        <span>Account Type</span>
                        <span style="color: var(--text-primary); font-weight: 500; text-transform: capitalize;">${this.state.user.role}</span>
                    </div>
                    <div class="info-row">
                        <span>Purchased Books</span>
                        <span style="color: var(--accent-blue); font-weight: 600;">${this.state.user.purchasedBooks?.length || 0}</span>
                    </div>
                `;
            }

            updateProfileImage() {
                const profileAvatar = document.getElementById('profileAvatar');
                if (!profileAvatar) return;

                if (this.state.userProfileImage) {
                    profileAvatar.innerHTML = `
                        <img src="${this.state.userProfileImage}" alt="Profile" style="width: 100%; height: 100%; object-fit: cover;">
                        <div class="avatar-upload-btn" id="avatarUploadBtn">
                            <span class="material-symbols-rounded">photo_camera</span>
                        </div>
                    `;
                } else {
                    profileAvatar.innerHTML = `
                        <div class="avatar-placeholder">
                            <span class="material-symbols-rounded">person</span>
                        </div>
                        <div class="avatar-upload-btn" id="avatarUploadBtn">
                            <span class="material-symbols-rounded">photo_camera</span>
                        </div>
                    `;
                }

                // Reattach event listener
                document.getElementById('avatarUploadBtn').addEventListener('click', () => {
                    this.showAvatarUploadModal();
                });
            }

            showMyBooks() {
                if (!this.state.user) {
                    this.showToast('Please sign in to view your books', 'warning');
                    this.showAuthModal();
                    return;
                }

                const modalContent = `
                    <div class="modal">
                        <div class="modal-header">
                            <h2 class="modal-title">
                                <span class="material-symbols-rounded">library_books</span>
                                My Purchased Books
                            </h2>
                            <div class="modal-close" onclick="app.closeModal()">
                                <span class="material-symbols-rounded">close</span>
                            </div>
                        </div>
                        <div class="modal-body">
                            ${this.state.user.purchasedBooks?.length ? 
                                this.state.user.purchasedBooks.map(bookId => {
                                    const book = this.state.books.find(b => b.id === bookId);
                                    return book ? `
                                        <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; border-bottom: 1px solid var(--border-light);">
                                            <img src="${book.image}" style="width: 50px; height: 65px; border-radius: 8px;" onerror="this.src='https://picsum.photos/400/600?book'">
                                            <div style="flex: 1;">
                                                <div style="font-weight: 600; color: var(--text-primary);">${book.title}</div>
                                                <div style="color: var(--text-secondary); font-size: 0.9rem;">by ${book.author}</div>
                                            </div>
                                            <button class="btn btn-secondary" onclick="app.showBookPreview('${book.id}')" style="padding: 6px 12px; font-size: 0.8rem;">
                                                Read
                                            </button>
                                        </div>
                                    ` : '';
                                }).join('') : 
                                '<div style="text-align: center; padding: 2rem; color: var(--text-secondary);">No purchased books yet</div>'
                            }
                        </div>
                    </div>
                `;
                this.openModal(modalContent);
            }

            showAvatarUploadModal() {
                if (!this.state.user) {
                    this.showToast('Please sign in to change profile picture', 'warning');
                    this.showAuthModal();
                    return;
                }

                const modalContent = `
                    <div class="modal">
                        <div class="modal-header">
                            <h2 class="modal-title">
                                <span class="material-symbols-rounded">photo_camera</span>
                                Update Profile Picture
                            </h2>
                            <div class="modal-close" onclick="app.closeModal()">
                                <span class="material-symbols-rounded">close</span>
                            </div>
                        </div>
                        <div class="modal-body">
                            <div class="centered-form">
                                <div style="text-align: center; margin-bottom: 2rem;">
                                    <div id="imagePreview" style="width: 150px; height: 150px; border-radius: 50%; background: var(--gradient-primary); margin: 0 auto 1rem; display: flex; align-items: center; justify-content: center; color: white; font-size: 3rem; overflow: hidden;">
                                        ${this.state.userProfileImage ? 
                                            `<img src="${this.state.userProfileImage}" alt="Current" style="width: 100%; height: 100%; object-fit: cover;">` : 
                                            `<span class="material-symbols-rounded">person</span>`
                                        }
                                    </div>
                                    <h3 style="color: var(--text-primary); margin-bottom: 0.5rem;">Upload New Photo</h3>
                                    <p style="color: var(--text-secondary);">Choose a photo from your computer</p>
                                </div>
                                <form id="avatarUploadForm" onsubmit="app.handleAvatarUpload(event)">
                                    <div class="form-group">
                                        <label class="form-label">
                                            <span class="material-symbols-rounded">image</span>
                                            Select Image
                                        </label>
                                        <input type="file" class="form-input" id="avatarFile" accept="image/*" required>
                                        <small style="color: var(--text-muted); display: block; margin-top: 0.25rem;">Supported formats: JPG, PNG, GIF (Max 5MB)</small>
                                    </div>
                                    <div class="form-actions">
                                        <button type="button" class="btn btn-secondary" onclick="app.closeModal()">Cancel</button>
                                        <button type="submit" class="btn btn-primary">
                                            <span class="material-symbols-rounded">upload</span>
                                            Upload Photo
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                `;

                this.openModal(modalContent);

                // Preview image when selected
                const avatarFile = document.getElementById('avatarFile');
                const imagePreview = document.getElementById('imagePreview');
                avatarFile.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            imagePreview.innerHTML = `<img src="${e.target.result}" alt="Preview" style="width: 100%; height: 100%; object-fit: cover;">`;
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }

            handleAvatarUpload(event) {
                event.preventDefault();
                const fileInput = document.getElementById('avatarFile');
                if (!fileInput.files[0]) {
                    this.showToast('Please select an image', 'error');
                    return;
                }

                const file = fileInput.files[0];
                if (file.size > 5 * 1024 * 1024) {
                    this.showToast('File size must be less than 5MB', 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    this.state.userProfileImage = e.target.result;
                    localStorage.setItem('bp_user_profile_image', this.state.userProfileImage);
                    this.updateProfileImage();
                    this.closeModal();
                    this.showToast('Profile picture updated successfully!', 'success');
                };
                reader.readAsDataURL(file);
            }

            showEditProfileModal() {
                if (!this.state.user) return;

                const modalContent = `
                    <div class="modal">
                        <div class="modal-header">
                            <h2 class="modal-title">
                                <span class="material-symbols-rounded">edit</span>
                                Edit Profile
                            </h2>
                            <div class="modal-close" onclick="app.closeModal()">
                                <span class="material-symbols-rounded">close</span>
                            </div>
                        </div>
                        <div class="modal-body">
                            <div class="centered-form">
                                <form id="editProfileForm" onsubmit="app.handleEditProfile(event)">
                                    <div class="form-group">
                                        <label class="form-label">
                                            <span class="material-symbols-rounded">person</span>
                                            Full Name
                                        </label>
                                        <input type="text" class="form-input" id="editName" required value="${this.state.user.name}">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">
                                            <span class="material-symbols-rounded">phone</span>
                                            Phone Number
                                        </label>
                                        <input type="tel" class="form-input" id="editPhone" required value="${this.state.user.phone}">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">
                                            <span class="material-symbols-rounded">cake</span>
                                            Age
                                        </label>
                                        <input type="number" class="form-input" id="editAge" required min="13" max="120" value="${this.state.user.age}">
                                    </div>
                                    <div class="form-actions">
                                        <button type="button" class="btn btn-secondary" onclick="app.closeModal()">Cancel</button>
                                        <button type="submit" class="btn btn-primary">
                                            <span class="material-symbols-rounded">save</span>
                                            Save Changes
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                `;
                this.openModal(modalContent);
            }

            handleEditProfile(event) {
                event.preventDefault();
                const name = document.getElementById('editName').value.trim();
                const phone = document.getElementById('editPhone').value.trim();
                const age = document.getElementById('editAge').value.trim();

                if (!name || !phone || !age) {
                    this.showToast('Please fill in all required fields', 'error');
                    return;
                }

                if (age < 13 || age > 120) {
                    this.showToast('Age must be between 13 and 120', 'error');
                    return;
                }

                this.state.user = {
                    ...this.state.user,
                    name,
                    phone,
                    age: parseInt(age)
                };

                // Update in admin users
                const adminUserIndex = this.state.adminUsers.findIndex(u => u.email === this.state.user.email);
                if (adminUserIndex !== -1) {
                    this.state.adminUsers[adminUserIndex] = {
                        ...this.state.adminUsers[adminUserIndex],
                        name,
                        phone,
                        age: parseInt(age)
                    };
                    this.saveAdminUsers();
                }

                this.saveUser();
                this.renderProfile();
                this.closeModal();
                this.showToast('Profile updated successfully', 'success');
            }

            getCategoryName(category) {
                const categories = {
                    web: 'Web Development',
                    mobile: 'Mobile Development',
                    data: 'Data Science',
                    ai: 'AI & Machine Learning',
                    devops: 'DevOps',
                    algorithms: 'Algorithms'
                };
                return categories[category] || category;
            }

            openModal(content) {
                const modalOverlay = document.getElementById('modalOverlay');
                if (modalOverlay) {
                    modalOverlay.innerHTML = content;
                    modalOverlay.classList.add('active');
                    setTimeout(() => {
                        modalOverlay.style.opacity = '1';
                    }, 10);
                }
            }

            closeModal() {
                const modalOverlay = document.getElementById('modalOverlay');
                if (modalOverlay) {
                    modalOverlay.classList.remove('active');
                    setTimeout(() => {
                        modalOverlay.style.opacity = '0';
                        modalOverlay.innerHTML = '';
                    }, 300);
                }
            }

            showToast(message, type = 'info') {
                const toastContainer = document.getElementById('toastContainer');
                if (!toastContainer) return;

                const toastId = 'toast-' + Date.now();
                const icon = type === 'success' ? 'check_circle' : type === 'error' ? 'error' : 'info';
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.id = toastId;
                toast.innerHTML = `
                    <span class="material-symbols-rounded">${icon}</span>
                    <span>${message}</span>
                `;

                toastContainer.appendChild(toast);

                setTimeout(() => {
                    toast.classList.add('show');
                }, 10);

                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 300);
                }, 3000);
            }

            saveUser() {
                localStorage.setItem('bp_user', JSON.stringify(this.state.user));
            }

            saveCart() {
                localStorage.setItem('bp_cart', JSON.stringify(this.state.cart));
            }

            saveRegisteredUsers() {
                localStorage.setItem('bp_registered_users', JSON.stringify([...this.state.registeredUsers]));
            }

            saveBooks() {
                localStorage.setItem('bp_books', JSON.stringify(this.state.books));
            }

            saveAdminUsers() {
                localStorage.setItem('bp_admin_users', JSON.stringify(this.state.adminUsers));
            }
        }

        class ChatSystem {
            constructor(app) {
                this.app = app;
                this.messages = [];
                this.unreadCount = 0;
                this.isOpen = false;
                this.init();
            }

            init() {
                this.loadMessages();
                this.setupEventListeners();
                this.renderMessages();
            }

            setupEventListeners() {
                document.getElementById('chatClose').addEventListener('click', () => this.closeChat());
                document.getElementById('sendMessage').addEventListener('click', () => this.sendMessage());
                document.getElementById('chatInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });
            }

            toggleChat() {
                const container = document.getElementById('chatContainer');
                this.isOpen = !this.isOpen;
                container.style.display = this.isOpen ? 'flex' : 'none';
                if (this.isOpen) {
                    this.unreadCount = 0;
                    this.updateBadge();
                }
            }

            closeChat() {
                document.getElementById('chatContainer').style.display = 'none';
                this.isOpen = false;
            }

            sendMessage() {
                const input = document.getElementById('chatInput');
                const text = input.value.trim();
                
                if (!text || !this.app.state.user) {
                    this.showToast('Please sign in to send messages', 'warning');
                    return;
                }

                const message = {
                    id: Date.now(),
                    text,
                    sender: this.app.state.user.email,
                    senderName: this.app.state.user.name,
                    timestamp: new Date().toLocaleTimeString(),
                    isAdmin: this.app.state.user.role === 'admin'
                };

                this.messages.push(message);
                this.saveMessages();
                this.renderMessages();
                input.value = '';

                // Auto-reply for non-admin users
                if (!message.isAdmin) {
                    setTimeout(() => {
                        this.addAdminReply(message);
                    }, 1000);
                }
            }

            addAdminReply(userMessage) {
                const replies = [
                    "Thank you for your message! How can I help you?",
                    "Our team will get back to you shortly.",
                    "Is there anything specific you'd like to know about our books?",
                    "Thank you for contacting Better Programmer support!"
                ];

                const reply = {
                    id: Date.now(),
                    text: replies[Math.floor(Math.random() * replies.length)],
                    sender: 'admin@betterprogrammer.com',
                    senderName: 'Support Team',
                    timestamp: new Date().toLocaleTimeString(),
                    isAdmin: true
                };

                this.messages.push(reply);
                this.saveMessages();
                this.renderMessages();

                if (!this.isOpen) {
                    this.unreadCount++;
                    this.updateBadge();
                }
            }

            renderMessages() {
                const container = document.getElementById('chatMessages');
                container.innerHTML = this.messages.map(msg => `
                    <div class="message ${msg.isAdmin ? 'admin' : 'user'}">
                        <div style="font-weight: 600; margin-bottom: 0.25rem;">
                            ${msg.senderName}
                        </div>
                        <div>${msg.text}</div>
                        <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.25rem;">
                            ${msg.timestamp}
                        </div>
                    </div>
                `).join('');
                container.scrollTop = container.scrollHeight;
            }

            updateBadge() {
                const badge = document.getElementById('chatBadge');
                if (this.unreadCount > 0) {
                    badge.style.display = 'flex';
                    badge.textContent = this.unreadCount > 9 ? '9+' : this.unreadCount;
                } else {
                    badge.style.display = 'none';
                }
            }

            saveMessages() {
                localStorage.setItem('bp_chat_messages', JSON.stringify(this.messages));
            }

            loadMessages() {
                const saved = localStorage.getItem('bp_chat_messages');
                this.messages = saved ? JSON.parse(saved) : [];
            }

            showToast(message, type) {
                this.app.showToast(message, type);
            }
        }

        // Initialize the app
        const app = new BetterProgrammerApp();
    </script>
</body>
</html>
